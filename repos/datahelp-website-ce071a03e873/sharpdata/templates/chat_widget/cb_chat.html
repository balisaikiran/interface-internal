<!DOCTYPE html>

{% load static %}


<head>


  <!-- Fonts CDN -->
  <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />

  <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" />
  <link crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css"
    integrity="sha512-63+XcK3ZAZFBhAVZ4irKWe9eorFG0qYsy2CaM5Z+F3kUn76ukznN0cp4SArgItSbDFD1RrrWgVMBY9C/2ZoURA=="
    rel="stylesheet" />
  <link crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
    integrity="sha512-aEe/ZxePawj0+G2R+AaIxgrQuKT68I28qh+wgLrcAJOz3rxCP+TwrK5SPN+E5I+1IQjNtcfvb96HDagwrKRdBw=="
    rel="stylesheet" />
  <link crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.css"
    integrity="sha512-2e0Kl/wKgOUm/I722SOPMtmphkIjECJFpJrTRRyL8gjJSJIP2VofmEbqyApMaMfFhU727K3voz0e5EgE3Zf2Dg=="
    rel="stylesheet" />
  <link crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.min.css"
    integrity="sha512-tjNtfoH+ezX5NhKsxuzHc01N4tSBoz15yiML61yoQN/kxWU0ChLIno79qIjqhiuTrQI0h+XPpylj0eZ9pKPQ9g=="
    rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
  <style>
    * {
      box-sizing: border-radius;
      font-family: "poppins" !important;
    }

    body {
      font-size: 13px;
      font-family: "poppins" !important;
      min-height: 400px;
       /* Added as bugfix */
      overflow-x: hidden;
	    overflow-y: visible;
    }
    
    .fs-small {
      font-size: 8px;
    }

    .add-on:hover {
      transform: scale(1.2);
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: ease-out 0.2s;
    }

    :root {
      --background-color: #eeeef5;
      --primary: #065697;
      --primary-hover: #065697;
    }

    .shadow-add {
      box-shadow: 0px 8px 8px rgba(0, 0, 0, 0.2);
    }

    .hrx {
      opacity: 0.1;
    }

    .card-chip:hover {
      box-shadow: 0 0.5rem 0.5rem rgba(0, 0, 0, .15) !important;
      transition: ease-out 0.1s;
    }

    .card-chip {
      cursor: pointer;
    }

    .bd {
      border: solid red 1px !important;
    }

    a {
      cursor: pointer;
    }

    a:hover {
      color: inherit;
    }

    .bg-color-1 {
      background: #F9F9F9;
    }

    .pointer {
      cursor: pointer;
    }

    img {
      object-fit: cover;
    }

    .text-justify {
      text-align: justify;
    }


    .btn-primary-send {
      background-color: var(--primary);
      font-size: 14px;
      border-color: var(--primary);
      color: #fff;
      outline: none !important;
    }

    .btn-primary {
      background-color: var(--primary);
      font-size: 14px;
      border-color: var(--primary);
      color: #fff;
      outline: none !important;
    }

    .btn-primary:hover,
    .btn-primary:focus,
    .btn-primary:active {
      background-color: transparent;
      border-color: var(--primary-hover);
      color: #065697;
      outline: 0px !important;
    }

    .btn-primary-outline {
      background-color: transparent;
      border-color: var(--primary);
      color: var(--primary);
      outline: 0px !important;
    }

    .btn-primary-outline:hover,
    .btn-primary-outline:focus,
    .btn-primary-outline:active {
      background-color: var(--primary);
      border-color: var(--primary);
      color: #ffffff;
      outline: 0px !important;
    }

    .text-primary {
      color: var(--primary) !important;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .input-bn {
      font-size: 14px;
      box-sizing: border-box;
      border-radius: 5px !important;
      border: 1.5px solid #8692A6 !important;
      height: 55px !important;
    }

    .input-bn:focus {
      border: 2px solid #065697 !important;
      box-shadow: none;
      background: #FFFFFF;
      box-sizing: border-box;
      border-radius: 6px;
    }

    .textarea-bn-send{
      font-size: 14px;
      box-sizing: border-box;
      border-radius: 5px !important;
      border: 1.5px solid #8692A6 !important;
      border-radius: 4px 0px 0px 4px !important;
    }
    .textarea-bn-send:focus {
      border: 2px solid #065697 !important;
      box-shadow: none;
      background: #FFFFFF;
      box-sizing: border-box;
      border-radius: 4px 0px 0px 4px !important;
    }

    textarea {
      font-size: 12px !important;
      box-sizing: border-box;
      border-radius: 5px !important;
      border: 1.5px solid #8692A6 !important;
      min-height: 55px !important;
    }

    textarea:focus {
      border: 2px solid #065697 !important;
      box-shadow: none !important;
      background: #FFFFFF;
      box-sizing: border-box;
      border-radius: 6px;
    }


    .form-floating>.form-control:focus~label,
    .form-floating>.form-control:not(:placeholder-shown)~label,
    .form-floating>.form-select~label {
      opacity: 1 !important;
      color: #808080;
      height: 15px !important;
      padding: 2px !important;
      background: white;
      transform: scale(1) translateY(-0.6rem) translateX(0.85rem) !important;
    }

    .form-floating>.form-control:focus,
    .form-floating>.form-control:not(:placeholder-shown) {
      padding-top: 0.925rem !important;
    }

    .form-floating>.form-select {
      padding-top: 0.925rem !important;
      padding-bottom: 0.625rem;
    }

    .error_message {
      color: red;
    }

    .reqField {
      font-size: 8px;
      color: red;
    }

    .missingField {
      color: red !important;
    }

    .terminate_div {
      display: none;
    }

    .terminate_button {
      float: right;
      min-width: fit-content;
    }

    .form-select:disabled {
      background-color: white;
    }
    .bg-color-send{
    background: #F3F7FA;
  }
  </style>
  <style>
  .show{
    display: block;
  }
  .accordion-button:not(.collapsed){
    color: #444 !important;
    background: none !important;
    box-shadow: none !important;
  }
  .accordion-button:focus{
    border-color: none !important;
    box-shadow: none !important;
  }
  .seh{
        margin-left: -5px !important;
  }
  .seh:hover, .seh:focus, .seh:active:focus{
    background: #0097cf;
    color: white;
    border-color: #0097cf;
    outline: none;
    box-shadow: none;
  }
  .link-btn {
    background: #065697;
    font-size: 12px;
    padding: 5px 5px;
    float: right;
    color: white;
    border-radius: 4px;
  }
  .link-btn::before {
    content: \e1cd !important;
  }
  .link-btn:hover {
    color: #f9f9f9;
    background: #0097cf !important;
    transform: scale(1.1);
  }
  .autocomplete-active .link-btn {
    background: white !important;
    color: #065697;
  }

  .autocomplete {
    /*the container must be positioned relative:*/
    position: relative;
    display: inline-block;
  }
  .autocomplete-items {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    /*position the autocomplete items to be the same width as the container:*/
    top: 100%;
    left: 0;
    right: 0;
  }
  .autocomplete-items div {
    padding: 15px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
  }
  .autocomplete-items div:hover {
    /*when hovering an item:*/
    background-color: #f9f9f9;
  }
  .autocomplete-active {
    /*when navigating through the items using the arrow keys:*/
    background-color: DodgerBlue !important;
    color: #ffffff;
  }
  .ixc .tool-tip {
    visibility: hidden;
    max-width: 170px;
    font-size: 12px;
    background-color: #23455B;
    color: #f4f4f4;
    border-radius: 6px;
    padding: 10px 13px;
    position: absolute;
    left:40px;
    top: 45px;
    z-index: 1;
    box-shadow:3px 5px 15px rgba(0, 0, 0, 0.15);
  }
  .ixc:hover .tool-tip {
    visibility: visible;
  }  
  .img-chat{
    border:2px solid #aec8de;
    background: #fff;
    border-radius: 10000px;
    width:20px;
    height:20px;
    font-size: 8px;
    font-weight: 600;

  }
  .user-chat{
    background: #e2eff9;
    display: flex;
    flex-direction: column;
    border-radius:10px;
    padding: 1rem;
    margin-top:1.5rem;
    margin-bottom:1.5rem;
    border:1px solid #dee2e6!important;
    width: 100%;
  }
  .machine-chat{
    background: #F9f9f9;
    display: flex;
    flex-direction: column;
    border-radius:10px;
    padding: 1rem;
    margin-top:1.5rem;
    margin-bottom:1.5rem;
    border:1px solid #dee2e6!important;
    width: 100%;
  }
  .typing-indicator img{
    height: 40px !important;
  }

  html {
    scroll-behavior: smooth;
  }
  

</style>

</head>

<body class="bg-white">
  <div id="loader" style="display: none;">
    {% include "common_form/loader.html" %}    
  </div>
  <div id="demo" class="p-4">

    <div class=" d-flex justify-content-between align-items-center" id="back_button">


      <img src="https://fs.hubspotusercontent00.net/hub/21128156/hubfs/Interface-dark-logo.png?width=108&height=108"
        width="45">
      <b class="text-decoration-underline text-dark pointer"><i class="iconify"
          data-icon="material-symbols:arrow-back-rounded"> </i> 
          <a onclick="showLoaderOnClick('{% url 'list_conversations' %}?context={{context_data}}&signature={{signature}}')">
             Go back
          </a>
      </b>
    </div>

    <hr class="hr"> 
    {% if conversation_id %}
    <a onclick="PreviousChatsObj.get()">
    <div class=" d-flex justify-content-between align-items-center custom-card-borderx bg-color-1 border text-wrap w-100 mt-4 mb-4 px-3 py-2" id="load-btn" style="border-radius:15px;">
      {% csrf_token %}
      <div class="d-flex flex-wrap align-items-center">
        <i class="iconify fs-5" data-icon="material-symbols:avg-time"></i>
        <b class="ps-1 fw-bold">Load More Conversations</b>
      </div>
      <i class="iconify" data-icon="mdi:chevron-double-right"></i>
    </div>
    </a>
    {% endif %}
    <section id="Cb_Container">
      {% if show_dummy %}
      <!-- ----------chat from user----------------- -->
      <div class="user-chat">
        <!-- <div class="d-flex justify-content-center align-items-center img-chat mb-2">
          AD
        </div> -->
        <p class="m-0">Please generate a draft to send to a new contact for a standard listing and with a calculative tone </p>
      </div>

      <!-- ----------chat from GPT----------------- -->
      <div class="machine-chat">
        <div class="pe-2 mb-2">
          <img class="img-chat" src="https://interface.re/wp-content/uploads/2023/04/gpt.png">
        </div>
        <p class="m-0">Dear [Contact],
          I hope this email finds you well. My name is [Your Name] and I'm reaching out to you regarding a standard listing.
          We offer a wide range of listing options to help you get the most out of your business. Our standard listing is designed to 
          provide a cost-effective solution for businesses looking to expand their online presence.</p>

        <!-- <div class=" mt-2 pt-2 d-flex justify-content-between border-top w-100">

          <div class="d-flex justify-content-center align-items-center pe-2">
            <i class="iconify fa-hand-pointer fs-5 m-0" data-icon="mdi-chevron-left"></i>
            <span class="px-2">1/2</span>
            <i class="iconify pointer fs-5 m-0" data-icon="mdi-chevron-right"></i>
          </div>

          <div class="btn py-0 px-1 btn-primary-outline" style="margin-left: auto;">
            <i class="iconify m-0" data-icon="ion:refresh-circle"></i>
          </div> -->

        <!-- </div> -->

      </div>
      {% endif %}


    </section>
    <!-- <div class="d-flex flex-column justify-content-center align-content-center my-4">

      <div class="input-group mb-3 w-100 form-group">
        <input id="user_inp" class="form-control input-bn" style="border-radius: 4px 0px 0px 4px !important;" placeholder="Send a Message..."  />
        <button class="btn mb-3 btn-primary-send btn-submit" style="height:55px;" onclick="send_button()" type="button">
          <i class="iconify text-white" data-icon="bi:send-fill"></i>
        </button>
      </div>

    </div> -->

    <div class="d-flex flex-wrap gap-2 align-items-center">

      <div class="pointer d-flex justify-content-between w-100 fw-bold text-decoration-underline mb-3" id="promt-header" data-bs-toggle="collapse" data-bs-target="#prompts-container">
        Example Prompts
        <i class="iconify fs-5" data-icon="mdi:chevron-down"></i>
      </div>

      <div id="prompts-container" class="accordion-collapse collapse show">

        <div class="d-flex flex-wrap gap-2 ">

          <div data-bs-toggle="collapse" data-bs-target="#prompts-container" class="copy-text col bg-color-send pointer bg-color-se d-flex justify-content-between align-items-center custom-card-borderx border text-wrap mb-3  p-2" style="border-radius:5px;">
            <b class="ps-1 fw-bold">Make the following email more persuasive and succinct. Also, remove any fluff. [Paste Email Here]</b>
          </div>
  
          <div data-bs-toggle="collapse" data-bs-target="#prompts-container" class="copy-text col bg-color-send pointer bg-color-se d-flex justify-content-between align-items-center custom-card-borderx border text-wrap mb-3  p-2" style="border-radius:5px;">
            <b class="ps-1 fw-bold">Write out 5 text ideas to send to a client who is considering selling their home and requested a follow up in 3 months.</b>
          </div>
  
        </div>
  
        <div class="d-flex flex-wrap gap-2 ">

          <div data-bs-toggle="collapse" data-bs-target="#prompts-container" class="copy-text col bg-color-send pointer bg-color-se d-flex justify-content-between align-items-center custom-card-borderx border text-wrap mb-3  p-2" style="border-radius:5px;">
            <b class="ps-1 fw-bold">Write a listing description for a _ bedroom _ bath [Property Type] in [City], [State]. The house is on a [Describe Street/Location] and has a [Feature 1]. The house is [Property Description]. Also, highlight the [Feature 3] and that it’s [Feature 4].</b>
          </div>
  
          <div data-bs-toggle="collapse" data-bs-target="#prompts-container" class="copy-text col-12 bg-color-send pointer bg-color-se d-flex justify-content-between align-items-center custom-card-borderx border text-wrap mb-3  p-2" style="border-radius:5px;">
            <b class="ps-1 fw-bold">Ex: Write a listing description for a 3 bedroom 2 bath Single-Family home in Carlsbad, CA. The house is on a cul-de-sac and has a newly updated kitchen with granite countertops and a gas stove. The house is two stories, 2300 square feet, and has a double garage. Also, highlight the big backyard and that it’s close to shops and cafes.</b>
          </div>

        </div>

      </div>

    </div>

    <div class="d-flex flex-column justify-content-center align-content-center my-4">      

      <div class="input-group align-items-stretch mb-2 w-100 form-group">
        <textarea id="user_inp" class="txta form-control textarea-bn-send" rows='1' placeholder="Send a Message..."></textarea>
        <button class="btn btn-primary-send btn-submit" onclick="send_button()" type="button" id="submitButton" disabled>
          <i class="iconify text-white" data-icon="bi:send-fill"></i>
        </button>
      </div>

    </div>

    
    
    <div class="d-flex align-items-center justify-content-center">
      <i class="iconify fs-5 me-2 text-muted" data-icon="mdi:like"></i>
      <a href="https://datahelp.wufoo.com/forms/k18qg7fs0up48dd/" target="_blank"
            class="text-decoration-underline small text-dark my-2">Give us your feedback
      </a>
    </div>

    <hr class="hr col-12">
    <div class="w-100 mt-4 mb-4 d-flex flex-wrap justify-content-between align-items-center">
              
      <img src="https://datalabz.re/static/images/interface_logo.png" class="my-2" width="100">
      <a href="https://knowledge.interface.re/fub-embedded-app-documentation" target="_blank"
          class="text-decoration-underline small text-dark my-2">Learn more about InterFace
      </a>
    </div>

  
    
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
  <!-- Iconify icons -->
  <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
  <!-- Bootstrap JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js"></script>
  <script src="https://eia.followupboss.com/embeddedApps-v1.0.0.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{% static 'js/conditionize.flexible.jquery.js' %}"></script>
  <script src="../../static/js/conditionize.flexible.jquery.js"></script>

<script>
    // var textarea = document.querySelector('textarea');
    // textarea.addEventListener('keydown', autosize);
    // textarea.addEventListener('paste', autosize);
     
    // function autosize(){
    //   var el = this;
    //   setTimeout(function(){
    //     el.style.cssText = 'height:auto; padding:10px';
    //     el.style.cssText = 'height:' + el.scrollHeight + 'px';
    //   },0);
    // }

    $('.txta').on('input', function () {
        this.style.height = 'auto';
        this.style.height =
                (this.scrollHeight) + 'px';
    });

</script>




{% if conversation_id %}
<script id="previousData" type="application/json">{{ previous_chats }}</script>
{% endif %}
<script>
var conv_id = "{{ conversation_id }}"

function createUserMsgBubble(message, position, id) {
  var messagebubble = `
      <div class="user-chat">
          ${message}
      </div>
      `;

  var usrMsg = document.createElement('div');
  usrMsg.innerHTML = messagebubble;
  position === "prepend" ?
  document.getElementById('Cb_Container').prepend(usrMsg) :
  document.getElementById('Cb_Container').appendChild(usrMsg);
}

function createChabotMsgBubble(message, position) {

  var messagebubble = `
      <div class="machine-chat">
        <div class="pe-2 mb-2">
          <img class="img-chat" src="https://interface.re/wp-content/uploads/2023/04/gpt.png">
        </div>
        <p class="m-0">
          ${message.replace(/\n/g, "<br />")}
        </p>
      </div>
      `;

  var cbMsg = document.createElement('div');
  cbMsg.innerHTML = messagebubble;
    position === "prepend" ? 
    document.getElementById('Cb_Container').prepend(cbMsg) :
    document.getElementById('Cb_Container').appendChild(cbMsg);
    
}


function make_api_call(url, payload, type) {
    console.log("URL & pl:", url, payload)
    
    const csrftoken = Cookies.get('csrftoken');
    var promise = new Promise(function (resolve, reject) {
        $.ajax({
            type: type,
            url: url,
            data: payload,
            dataType: "json",
            headers: {'X-CSRFToken': csrftoken},
            mode: 'same-origin',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (resultData) {
                var ourData = resultData;
                message_response = ourData.message_response;
                conversation_id = ourData.conversation_id;
                console.log("Data : ", ourData)
                resolve(ourData);
            }
        });
    });
    return promise;
}


function received_usr_message(message){

    createUserMsgBubble(message, "append");
    scrollToBottom()
    let indicator = '<div class="typing-indicator"><img src="{% static 'img/typing-dots.gif' %}"></div>';
    var typingMsg = document.createElement('div');
    typingMsg.innerHTML = indicator;
    document.getElementById('Cb_Container').appendChild(typingMsg);
    url = "{% url 'send_message' %}"

    payload = {
      "conversation_id": conv_id,
      "fub_person_id": "{{ fub_person_id }}",
      "team_id": "{{ team_id }}",
      "platform": "{{ platform }}",
      "user_name": "{{ user_name }}",
      "message": message
    }
    var promise = make_api_call(url, payload, "POST");
    console.log("promise", promise)
      promise.then(function (value) {
        console.log("MSG RESPONSE:", value.message_response, value.conversation_id)
        createChabotMsgBubble(value.message_response, "append");
         typingMsg.remove();
         scrollToBottom()
        if (value.conversation_id != null && value.conversation_id != undefined){
          conv_id = value.conversation_id
          console.log("value not null")
        }
      })

}

function send_button(){
  var user_message = document.getElementById('user_inp').value
  console.log("USER INPUT MESSAGE:", user_message)
  received_usr_message(user_message)
  document.getElementById('user_inp').value = ''
  scrollToBottom()
}

function scrollToBottom(){
  let pageBottom = document.querySelector('#user_inp');
  pageBottom.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
}

function htmlDecode(str) {
  const doc = new DOMParser().parseFromString(str, "text/html");
  return doc.documentElement.textContent;
}

function strToObj(str){
  var True = true, False = false, None = "";
  var obj = {};
  if(str&&typeof str ==='string'){
      var objStr = str.match(/\{(.)+\}/g);
      eval("obj ="+objStr);
  }
  console.log("obj", typeof obj, obj);
  return obj;
}

function process_previous_data(chats, position){
  console.log("chats", typeof chats, chats.length, chats)
  for (var i=0; i<chats.length; i++) {
    console.log(chats[i]);
    let content = chats[i].content;
    let role = chats[i].role;
    console.log('var:', i, role, content);
    role == "user" ? createUserMsgBubble(content, position) : createChabotMsgBubble(content, position);
  }
}

function htmlToObj(data){
  const decodedData =  htmlDecode(data);
  console.log("decodedData", typeof decodedData, decodedData);
  let data_obj = strToObj(decodedData);
  console.log("data_obj", typeof data_obj, data_obj)
  return data_obj
}

conv_id ?
$(document).ready(function () {
  const previousData = document.getElementById("previousData").textContent;
  console.log("CONST prevData", previousData)
  const previousData_obj =  htmlToObj(previousData);
  let chats = previousData_obj.message_data;
  console.log("chats", typeof chats, chats.length, chats)
  process_previous_data(chats, "append")
  scrollToBottom();
})
: ""

class PreviousChats{
  constructor(){
    var key = "{{ last_evaluated_key | safe }}"
    this.last_evaluated_key = key;
    this.get = this.get.bind(this);
    console.log("last_evaluated_key", this.last_evaluated_key);
  }
  get(){
    var url = "{% url 'get_chats' %}"
    console.log("this", this);
    console.log("last_evaluated_key", this.last_evaluated_key, typeof this.last_evaluated_key);
    var last_evaluated_key_obj = typeof this.last_evaluated_key === "string" ? strToObj(this.last_evaluated_key) : this.last_evaluated_key
    var payload = {
      "conversation_id": conv_id,
      "last_evaluated_key": last_evaluated_key_obj
    }
    console.log("payload", payload);
    var promise = make_api_call(url, payload, "POST");
    console.log("promise", promise);
      promise.then((function (value) {
        console.log("MSG RESPONSE:", value);
        var chats = value.message_response;
        this.last_evaluated_key = value.last_evaluated_key;
        console.log("updated_key", this.last_evaluated_key);
        if (this.last_evaluated_key === null ){
          document.getElementById('load-btn').remove();
        }
        process_previous_data(chats, "prepend");
      }).bind(this));
  }
}
PreviousChatsObj = new PreviousChats();
</script>
<script>
  $(document).ready(function () {
    $("#user_inp").keyup(function (e) {
      var code = e.keyCode || e.which;
      if ($(this).val().length != 0) {
        $(".btn-submit").attr("disabled", false);
        if (code === 13) {
          e.preventDefault();
          $(".btn-submit").click();
        }
      } else $(".btn-submit").attr("disabled", true);
    });
  });
</script>


<script>
  //Copies prompt text to an input field and removes prompt
  $('.copy-text').on('click', function() {
    $('#user_inp').val($(this).text().trim()).focus();
    $('#submitButton').prop('disabled', false);
    $(this).remove()
  });
</script>

<script>

  function showLoader() {
      document.getElementById('demo').style.display = "none";
      document.getElementById('loader').style.display = "block";
  }
  var timeout;

  function sleep(delay, url) {
      if (timeout) {
          clearTimeout(timeout);
      }
      timeout = setTimeout(function () {
          window.location.href = url;
      }, delay);
  }

  function showLoaderOnClick(url) {
      showLoader();
      sleep(500, url);
  }
  
</script>
</body>