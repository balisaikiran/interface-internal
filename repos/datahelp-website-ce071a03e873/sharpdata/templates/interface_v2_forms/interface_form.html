<!DOCTYPE html>
{% load static %}

<head>
  <!-- Fonts CDN -->
  <link
    href="https://fonts.googleapis.com/css?family=Poppins"
    rel="stylesheet"
  />
  <!-- Bootstrap CDN -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
    crossorigin="anonymous"
  />

  <link
    href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    rel="stylesheet"
  />

  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css"
    integrity="sha512-63+XcK3ZAZFBhAVZ4irKWe9eorFG0qYsy2CaM5Z+F3kUn76ukznN0cp4SArgItSbDFD1RrrWgVMBY9C/2ZoURA=="
    rel="stylesheet"
  />
  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
    integrity="sha512-aEe/ZxePawj0+G2R+AaIxgrQuKT68I28qh+wgLrcAJOz3rxCP+TwrK5SPN+E5I+1IQjNtcfvb96HDagwrKRdBw=="
    rel="stylesheet"
  />
  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.css"
    integrity="sha512-2e0Kl/wKgOUm/I722SOPMtmphkIjECJFpJrTRRyL8gjJSJIP2VofmEbqyApMaMfFhU727K3voz0e5EgE3Zf2Dg=="
    rel="stylesheet"
  />
  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.min.css"
    integrity="sha512-tjNtfoH+ezX5NhKsxuzHc01N4tSBoz15yiML61yoQN/kxWU0ChLIno79qIjqhiuTrQI0h+XPpylj0eZ9pKPQ9g=="
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    rel="stylesheet"
  />

  <style>
    * {
      box-sizing: border-radius;
      font-family: "poppins" !important;
    }

    .l-line {
      margin-left: 20px;
      transform: rotate(-24deg);
    }

    .r-line {
      margin-right: 20px;
      transform: rotate(24deg);
    }

    body {
      font-size: 13px;
      font-family: "poppins" !important;
      min-height: 400px;
      /* Added as bugfix */
      overflow-x: hidden;
      overflow-y: visible;
    }

    :root {
      --background-color: #eeeef5;
      --primary: #065697;
      --primary-hover: #065697;
    }

    .bd {
      border: solid red 1px !important;
    }

    a {
      cursor: pointer;
    }

    a:hover {
      color: inherit;
    }

    .bg-color-1 {
      background: #f9f9f9;
    }

    .pointer {
      cursor: pointer;
    }

    img {
      object-fit: cover;
    }

    .btn-primary {
      background-color: var(--primary);
      font-size: 14px;
      border-color: var(--primary);
      color: #fff;
      outline: none !important;
    }

    .btn-primary:hover,
    .btn-primary:focus,
    .btn-primary:active {
      background-color: transparent;
      border-color: var(--primary-hover);
      color: #065697;
      outline: 0px !important;
    }

    .btn-primary-outline {
      background-color: transparent;
      border-color: var(--primary);
      color: var(--primary);
      outline: 0px !important;
    }

    .btn-primary-outline:hover,
    .btn-primary-outline:focus,
    .btn-primary-outline:active {
      background-color: var(--primary);
      border-color: var(--primary);
      color: #ffffff;
      outline: 0px !important;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .opp-type-select {
      height: 30px;
      text-align: center;
    }

    button:disabled {
      background: #9ebdd5 !important;
      border: none;
    }
  </style>
</head>

<body class="bg-white">
  <div id="loader" style="display: none">
    {% include "common_form/loader.html" %}
  </div>
  <div id="demo" class="p-4">
    <div
      class="d-flex justify-content-between align-items-center"
      id="back_button"
    >
      <img
        src="https://fs.hubspotusercontent00.net/hub/21128156/hubfs/Interface-dark-logo.png?width=108&height=108"
        width="45"
      />
      <b class="text-decoration-underline text-dark pointer"
        ><i class="iconify" data-icon="material-symbols:arrow-back-rounded">
        </i>
        <a
          onclick="showLoaderOnClick('{% url 'interface_list_view' %}?context={{context_data}}&signature={{signature}}')"
        >
          Go back
        </a></b
      >
    </div>

    <hr class="hr" />

    <div class="d-flex justify-content-center text-center mb-2">
      <div>
        <b class="fs-6">Create New Opportunity</b>
        <p>Select Form</p>
      </div>
    </div>

    <form method="POST" class="mb-5">
      {% csrf_token %} {% if deal_id %}
      <input hidden name="deal_id" value="{{deal_id}}" />
      <input hidden name="appt_set_entry_id" value="{{appt_set_entry_id}}" />
      <input hidden name="appt_set_lead_type" value="{{appt_set_lead_type}}" />
      <input hidden name="appt_set_platform" value="{{appt_set_platform}}" />
      {% endif %}
      <input hidden name="domain" value="{{domain}}" />

    <!-- <div class="opp-type-select mb-3">
      <select id="fub_pipeline" name="fub_pipeline" required>
        <option selected disabled>Select Pipeline</option>
        {% for pipeline in fub_pipelines %}
            <option value="{{ pipeline }}">{{ pipeline }}</option>
        {% endfor %}
    </select>
    </div> -->
    <div class="opp-type-select mb-3">
      <select id="form_url" name="form_url" required>
          <option selected disabled>Select Form</option>
          {% for key, value in interface_formlinks.items %}
              <option value="{{ value }}">{{ key }}</option>
          {% endfor %}
      </select>
    </div>
      <div class="d-flex">
        <div class="form-actions col form-group text-center">
          <p>
            <a
              href=""
              class="btn-link"
              id="pipeline-link-btn"
            >
              <button id="form-btn" class="btn btn-primary col-8 center-btn" type="button" disabled
              >
                Take me to the form
              </button>
            </a>
          </p>
        </div>
      </div>
    </form>

    <hr class="hr col-12" />
    <div
      class="mt-4 mb-4 d-flex flex-column justify-content-center align-items-center"
    >
      <img
        src="https://datalabz.re/static/images/interface_logo.png"
        width="180"
      />
      <a
        href="https://knowledge.interface.re/fub-embedded-app-documentation"
        target="_blank"
        class="text-decoration-underline text-dark mt-2"
        >Learn more about InterFace</a
      >
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
  <!-- Iconify icons -->
  <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
  <!-- Bootstrap JS-->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://eia.followupboss.com/embeddedApps-v1.0.0.js"
    type="text/javascript"
  ></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{% static 'js/conditionize.flexible.jquery.js' %}"></script>
  <script src="../../static/js/conditionize.flexible.jquery.js"></script>
  <script>

    function showLoader() {
        document.getElementById('demo').style.display = "none";
        document.getElementById('loader').style.display = "block";
    }
    var timeout;
    function sleep(delay, url) {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(function () {
            window.location.href = url;
        }, delay);
    }
    function showLoaderOnClick(url) {
        showLoader();
        sleep(500, url);
    }
    var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = window.location.search.substring(1),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
            }
        }
        return false;
    };
    var myModal = new bootstrap.Modal(document.getElementById("opp_modal"), {});

   </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#pipeline-link-btn').css('pointer-events', 'none');
      $('#form_url').change(function() {
        var selectedOption = $(this).children('option:selected');
        var selectedUrl = selectedOption.val();
        var context = getUrlParameter('context');
        var signature = getUrlParameter('signature');
        var appendedUrl;
  
        // Check if the URL already contains parameters
        if (selectedUrl.includes('?')) {
          appendedUrl = selectedUrl + '&context=' + context + '&signature=' + signature;
        } else {
          appendedUrl = selectedUrl + '?context=' + context + '&signature=' + signature;
        }
  
        var pipelineLink = $('#pipeline-link-btn');
        var pipelineBtn = $('#form-btn');
  
        if (selectedUrl && selectedUrl !== "" && selectedUrl !== undefined) {
          pipelineLink.attr('href', appendedUrl);
          pipelineBtn.prop('disabled', false);
          $('#pipeline-link-btn').css('pointer-events', 'all');
        } else {
          pipelineBtn.prop('disabled', true);
          $('#pipeline-link-btn').css('pointer-events', 'none');
        }
      });
    });
  </script>
  
  
</body>
