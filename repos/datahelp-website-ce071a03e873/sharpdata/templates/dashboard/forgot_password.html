{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content=" sharpdata login page" name="description">

    <title>DataLabz - Login</title>
    
    <link href="https://i.imgur.com/QRAUqs9.png" rel="apple-touch-icon">
    <link href="https://i.imgur.com/QRAUqs9.png" rel="shortcut icon">


    <!-- Fonts CDN -->
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />
    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">

    <!-- assets css CDN -->
    <!-- <link href='assets/css/style.css' rel='stylesheet'> -->
    <link href="{% static 'css/styles.css'%}" rel="stylesheet">

    <!-- -------google analytics--------- -->
    <script async defer src="https://apis.google.com/js/platform.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-78898293-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-78898293-3');
    </script>
    <script>
        var linkedinLink = "https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=813nyuszjrr3o8&redirect_uri=http://localhost:8080/secure/verify_linkedin&state=fooobar&scope=r_liteprofile%20r_emailaddress%20w_member_social"

    </script>

</head>



<body class="bg-dark">

    <section class="container-md p-0 d-flex justify-content-center mt-md-3 mb-md-5 pb-md-5">

        <div class="mt-md-5 col-xl-11 auth-container shadow-lg d-flex flex-wrap">


            <div class="col-lg-6 col-12 pt-5 pb-5 px-4 px-md-5  text-center" style="background:#032241;">
                <div> 
                    <img class="img-fluid" src="{% static 'images/logoh.png'%}" width="200" alt="">
                </div>
               
                <p class=" d-none d-lg-block mt-3 mt-lg-5 text-white-50">Let's get you started; data superpowers to optimise your work process.</p>
                
                <div> 
                    <img class="img-fluid d-none d-lg-block" src="https://i0.wp.com/interface.re/wp-content/uploads/2022/09/Group-16970.png?w=955&ssl=1" alt="">
                </div>
            </div>
    

            <div class="col-lg-6 py-lg-5 pb-5 pt-5 px-4 px-md-5 col-12 auth-form" style="background:#fff;">

                

                {% if not has_code and not is_error %}
                <div class="d-flex mx-xl-5 my-xl-3 flex-column justify-content-center">
                    <div class="mb-3">
                        <i class="iconify display-1 text-primary" data-icon="tabler:mail-forward"></i>
                    </div>
                    <h5>Reset link sent</h5>
                    <p class="">We sent you an email with an OTP code. Please click on that link to reset your password!</p>
                </div>
                {% elif is_error %}

                <div class="d-flex mx-xl-5 my-xl-3 flex-column justify-content-center"></div>
                    <div class="mb-3">
                        <i class="iconify display-1 text-warning" data-icon="mdi:warning"></i>
                    </div>
                    <h5>Warning</h5>
                    <p class="fs-6 fw-meduim">Seem like the password you enter is same as old password, Please try to login or retry the password reset!</p>

                    <div>
                        <a class="btn w-100 mt-5 btn-primary" href="/secure/login_user">
                            <i class="iconify" data-icon="mdi:arrow-back"></i>
                            Go back to Login
                        </a>
                    </div>
                </div>

                {% else %}

                

                
                <form action="{% url 'forgot_password' %}" method="POST" id="forgotForm" class="mx-xl-5 my-xl-3">
                    {% csrf_token %}

                    <h5><i class="iconify text-primary me-1" data-icon="mdi:forgot-password"></i>Reset Password</h5>
                    <p>Create a new password to reset your credentials</p>
                    

                    <div class="mt-4">

                    </div>

                    <!-- --------Email------------ -->
                    <div class="mb-4">
                        <div class="form-floating w-100 form-group">
                            <input
                                placeholder=""
                                class="form-control input-bn"
                                id="user_email"
                                name="user_email"
                                required=""
                                type="text"
                                value="{{email}}"
                                readonly
                                style="background: #f7f7f7; border-color:#eee !important;"
                              />

                            <label>
                                <span class="d-flex align-items-center">
                                    <i class="iconify me-1 mr-1 fs-5" data-icon="carbon:email" ></i>
                                    <span>Email address</span>
                                </span>
                            </label>
                        </div>
                    </div>

                   

                    <!-- --------OTP------------ -->
                    <div class="mb-4">
                        <div class="form-floating w-100 form-group">
                            <input 
                                class="form-control input-bn" id="otp" name="otp" placeholder="" required="" type="text", value="{{otp_code}}"
                                readonly
                                style="background: #f7f7f7; border-color:#eee !important;"
                            />
                            <label>
                                <span class="d-flex align-items-center">
                                    <i class="iconify me-1 mr-1 fs-5" data-icon="material-symbols:key-outline" ></i>
                                    <span>OTP</span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- <hr class="hr my-4"> -->

                    <!-- --------New-password------------ -->
                    <div class="mb-4">
                        <div class="form-floating w-100 form-group">
                            <input class="form-control input-bn" id="new_password" name="new_password" placeholder="" required=""
                              type="password"/>
                            <label>
                                <span class="d-flex align-items-center">
                                    <i class="iconify me-1 mr-1 fs-5" data-icon="bi:shield-lock" ></i>
                                    <span>New Password</span>
                                </span>
                            </label>
                        </div>
                        <div id="popover-password">
                            <p class="small my-2">Password : <span id="result" class="text-danger"></span></p>
                            <div class="progress mb-2 col-5" style="height:5px;">
                                <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="40" class="progress-bar progress-bar-animated progress-bar-striped bg-success" id="password-strength" role="progressbar" style="width: 0%;">
                                </div>
                            </div>
                            <ul class="list-unstyled small">
                                <li class=""><span class="low-upper-case"><i aria-hidden="true" class="fa-regular fa-circle"></i></span>&nbsp; 1
                                    lowercase &amp; 1 uppercase
                                </li>
                                <li class=""><span class="one-number"><i aria-hidden="true" class="fa-regular fa-circle"></i></span> &nbsp;1
                                    number (0-9)
                                </li>
                                <li class=""><span class="one-special-char"><i aria-hidden="true" class="fa-regular fa-circle"></i></span>
                                    &nbsp;1 Special Character (!@#$%^&amp;*).
                                </li>
                                <li class=""><span class="eight-character"><i aria-hidden="true" class="fa-regular fa-circle"></i></span>&nbsp; Atleast 8
                                    Character
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- --------confirm-password------------ -->
                    <div class="mb-4">
                        <div class="form-floating w-100 form-group">
                            <input class="form-control input-bn" id="user_confirm_password" name="user_confirm_password"
                              required="" onkeypress="validateExuser()" type="password"/>
                            <label>
                                <span class="d-flex align-items-center">
                                    <i class="iconify me-1 mr-1 fs-5" data-icon="bi:shield-lock" ></i>
                                    <span>Confirm Password</span>
                                </span>
                            </label>
                        </div>
                        <span class="d-flex flex-column mt-1 mb-2">
                            <span class="hide pull-right block-help small" id="popover-cpassword" style="display: none;"><i
                                aria-hidden="true"
                                class="fa fa-info-circle text-danger"></i> Passwords don't match</span>
                            <span class="hide pull-right block-help small" id="popover-cpassword-2" style="display: none;"><i
                                aria-hidden="true" class="fa fa-info-circle text-danger"></i> Password is Invalid</span>
                        </span>

                        
                    </div>

                    

                    <div class="text-center">
                        <button class="btn btn-primary submit btn w-100 btn-primary mb-3 me-2" type="submit" id="sign-up" disabled>Confirm</button>
                    </div>

                </form>
                {% endif %}
            
                    
            
        

            </div>


        </div>

    </section>



<!-- Jquery and vendors -->
<script crossorigin="anonymous"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>

<!-- Bootstrap JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>

<!-- Iconify and FA icons -->
<script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js"></script>

<!-- other vendors -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
<script src="{% static 'assets/js/main.js'%}"></script>



<script>
    var linkedinLink = "https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=813nyuszjrr3o8&redirect_uri=http://localhost:8080/secure/verify_linkedin&state=fooobar&scope=r_liteprofile%20r_emailaddress%20w_member_social"


    function onSignIn(googleUser) {
        var id_token = googleUser.getAuthResponse().id_token;
        var profile = googleUser.getBasicProfile();
        console.log("Id token: ", id_token);
        location.replace("/secure/verify_google?idtoken=" + id_token);
        console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
        console.log('Name: ' + profile.getName());
        console.log('Image URL: ' + profile.getImageUrl());
        console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);
    }

    var validPass = false;
    function validateExuser(){
            if(validPass != false){
                $('#sign-up').attr("disabled", false);
            }
            else{
                $('#sign-up').attr("disabled", true);
            }
        }
    $(document).ready(function () {
    $('#new_password').on({input:(function () {
        var password = $('#new_password').val();
        if (checkStrength(password) == false) {
            var a = 1;
        }
    })
    });
        $('#user_confirm_password').on({input:(function () {
            $('#sign-up').attr("disabled", true);
            if ($('#new_password').val() != $('#user_confirm_password').val()) {
                $('#popover-cpassword').css("display", "block");
                validPass = false
            } else {
                validPass = true
                $('#popover-cpassword').css("display", "none");
                if (checkStrength($('#new_password').val()) == false) {
                    $('#popover-cpassword-2').css("display", "block");
                    validPass = false
                } else {
                    validPass = true
                    $('#popover-cpassword-2').css("display", "none");
                    validateExuser()
                }

            }
        })
        });

    function checkStrength(password) {
            var strength = 0;


            //If password contains both lower and uppercase characters, increase strength value.
            if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) {
                strength += 1;
                $('.low-upper-case').addClass('text-success');
                $('.low-upper-case i').removeClass('fa-file-text').addClass('fa-check');
                $('#popover-password-top').addClass('hide');


            } else {
                $('.low-upper-case').removeClass('text-success');
                $('.low-upper-case i').addClass('fa-file-text').removeClass('fa-check');
                $('#popover-password-top').removeClass('hide');
            }

            //If it has numbers and characters, increase strength value.
            if (password.match(/([a-zA-Z])/) && password.match(/([0-9])/)) {
                strength += 1;
                $('.one-number').addClass('text-success');
                $('.one-number i').removeClass('fa-file-text').addClass('fa-check');
                $('#popover-password-top').addClass('hide');

            } else {
                $('.one-number').removeClass('text-success');
                $('.one-number i').addClass('fa-file-text').removeClass('fa-check');
                $('#popover-password-top').removeClass('hide');
            }

            //If it has one special character, increase strength value.
            if (password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) {
                strength += 1;
                $('.one-special-char').addClass('text-success');
                $('.one-special-char i').removeClass('fa-file-text').addClass('fa-check');
                $('#popover-password-top').addClass('hide');

            } else {
                $('.one-special-char').removeClass('text-success');
                $('.one-special-char i').addClass('fa-file-text').removeClass('fa-check');
                $('#popover-password-top').removeClass('hide');
            }

            if (password.length > 7) {
                strength += 1;
                $('.eight-character').addClass('text-success');
                $('.eight-character i').removeClass('fa-file-text').addClass('fa-check');
                $('#popover-password-top').addClass('hide');

            } else {
                $('.eight-character').removeClass('text-success');
                $('.eight-character i').addClass('fa-file-text').removeClass('fa-check');
                $('#popover-password-top').removeClass('hide');
            }


            // If value is less than 2

            if (strength == 0) {
                $('#result').removeClass();
                $('#result').addClass('text-danger').text('Invalid')
                $('#password-strength').css('width', '0%');
                return false;
            } else if (strength == 1) {
                $('#result').removeClass()
                $('#password-strength').addClass('progress-bar-danger');

                $('#result').addClass('text-danger').text('Invalid');
                $('#password-strength').css('width', '25%');
                return false;
            } else if (strength == 2) {
                $('#result').addClass('good');
                $('#password-strength').removeClass('progress-bar-danger');
                $('#password-strength').addClass('progress-bar-warning');
                $('#result').addClass('text-danger').text('Invalid')
                $('#password-strength').css('width', '50%');
                return false;
            } else if (strength == 3) {
                $('#result').removeClass();
                $('#password-strength').removeClass('progress-bar-danger');
                $('#password-strength').addClass('progress-bar-warning');
                $('#result').addClass('text-warning').text('Invalid')
                $('#password-strength').css('width', '75%');
                return false;
            } else if (strength == 4) {
                $('#result').removeClass()
                $('#result').addClass('strong');
                $('#password-strength').removeClass('progress-bar-warning');
                $('#password-strength').addClass('progress-bar-success');
                $('#result').addClass('text-success').text('Valid');
                $('#password-strength').css('width', '100%');

                return true;
            }

        }

        $('#forgotForm').submit(function() {
            var password = $('#new_password').val();
            return checkStrength(password)
        });

    }

    );

    function checkSubmission() {
        alert('checkSubmission');
        var password = document.getElementById("new_password").value;
        var password_verify = document.getElementById("user_confirm_password").value;
        verifyPassword_response = verifyPassword(password, password_verify);
        if (verifyPassword_response == true) {
            return true;
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Oops..!',
                text: 'Some Error!',
                footer: '<a href>Why do I have this issue?</a>'
            })
            return false;
        }
    }

    var password = document.getElementById("new_password")
        , confirm_password = document.getElementById("user_confirm_password");

    function validatePassword() {
        if (password.value != confirm_password.value) {
            confirm_password.setCustomValidity("Passwords Don't Match");
        } else {
            confirm_password.setCustomValidity('');
        }
    }

    password.onchange = validatePassword;
    confirm_password.onchange = validatePassword;

    {% if is_error == '1' %}

    swal({
        title: '{{message_title}}',
        text: '{{message}}',
        icon: 'error',
        confirmButtonText: 'Ok'
    })
    {% endif %}

</script>



</body>
</html>
