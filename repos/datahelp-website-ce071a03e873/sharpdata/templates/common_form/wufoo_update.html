<!DOCTYPE html>
{% load static %}

<head>

    <!-- Fonts CDN -->
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />


    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">

    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css"
        integrity="sha512-63+XcK3ZAZFBhAVZ4irKWe9eorFG0qYsy2CaM5Z+F3kUn76ukznN0cp4SArgItSbDFD1RrrWgVMBY9C/2ZoURA=="
        rel="stylesheet" />
    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
        integrity="sha512-aEe/ZxePawj0+G2R+AaIxgrQuKT68I28qh+wgLrcAJOz3rxCP+TwrK5SPN+E5I+1IQjNtcfvb96HDagwrKRdBw=="
        rel="stylesheet" />
    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.css"
        integrity="sha512-2e0Kl/wKgOUm/I722SOPMtmphkIjECJFpJrTRRyL8gjJSJIP2VofmEbqyApMaMfFhU727K3voz0e5EgE3Zf2Dg=="
        rel="stylesheet" />
    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.min.css"
        integrity="sha512-tjNtfoH+ezX5NhKsxuzHc01N4tSBoz15yiML61yoQN/kxWU0ChLIno79qIjqhiuTrQI0h+XPpylj0eZ9pKPQ9g=="
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


    <style>
        * {
            box-sizing: border-radius;
            font-family: "poppins" !important;
        }

        .l-line {
            margin-left: 20px;
            transform: rotate(-24deg);

        }

        .r-line {
            margin-right: 20px;
            transform: rotate(24deg);

        }

        body {
            font-size: 13px;
            font-family: "poppins" !important;
            min-height: 400px;
             /* Added as bugfix */
            overflow-x: hidden;
            overflow-y: visible;
        }

        .add-on:hover {
            transform: scale(1.2);
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: ease-out 0.2s;
        }

        :root {
            --background-color: #eeeef5;
            --primary: #065697;
            --primary-hover: #065697;
        }

        .bd {
            border: solid red 1px !important;
        }

        a {
            cursor: pointer;
        }

        a:hover {
            color: inherit;
        }

        .pointer {
            cursor: pointer;
        }

        img {
            object-fit: cover;
        }

        .text-justify {
            text-align: justify;
        }


        .btn-primary {
            background-color: var(--primary);
            font-size: 14px;
            border-color: var(--primary);
            color: #fff;
            outline: none !important;
        }

        .btn-primary:hover,
        .btn-primary:focus,
        .btn-primary:active {
            background-color: transparent;
            border-color: var(--primary-hover);
            color: #065697;
            outline: 0px !important;
        }

        .btn-primary-outline {
            background-color: transparent;
            border-color: var(--primary);
            color: var(--primary);
            outline: 0px !important;
        }

        .btn-primary-outline:hover,
        .btn-primary-outline:focus,
        .btn-primary-outline:active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: #ffffff;
            outline: 0px !important;
        }

        .text-primary {
            color: var(--primary) !important;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .btn-disable{
            background: #9EBDD5 !important;
        }
        .disable-link{
        pointer-events: none;
        }
        .wufoo_terminate {
        display: none;
    }
    </style>
</head>


<body class="bg-white">

    <div id="loader" style="display: none;">
        {% include "common_form/loader.html" %}    
    </div>
    <div id="demo" class="p-4">

        <!-- Back button Code -->
        <div class=" d-flex justify-content-between align-items-center" id="back_button">
            <img src="https://fs.hubspotusercontent00.net/hub/21128156/hubfs/Interface-dark-logo.png?width=108&height=108"
                width="45">

            <b class="text-decoration-underline text-dark pointer"><i class="iconify"
                    data-icon="material-symbols:arrow-back-rounded"> </i> <a
                    onclick="showLoaderOnClick('{% url 'list_view' %}?context={{context_data}}&signature={{signature}}')"
                >Go back </a></b>
        </div>

        <hr class="hr">

        <div class=" d-flex justify-content-between text-center mb-2">
            <!-- <div> -->
                <b class="fs-6" id="form_heading">Update Opportunity</b>
                    <a href={{terminate_url}} target="_blank" id="terminate_toggle_btn" type="submit" value="submit" title="Terminate Transaction"
                    class="text-decoration-underline text-danger pointer">Terminate<i class="iconify" data-icon="ri:indeterminate-circle-line"></i></a> 
            <!-- </div> -->
        </div>

        <form method="POST" class="mb-3 mt-4">
            {% csrf_token %}
            {% if deal_id %}
            <input hidden name="deal_id" value="{{deal_id}}">
            <input hidden name="appt_set_entry_id" value="{{appt_set_entry_id}}">
            <input hidden name="appt_set_lead_type" value="{{appt_set_lead_type}}">
            <input hidden name="appt_set_platform" value="{{appt_set_platform}}">
            {% endif %}
            <input hidden name="domain" value="{{domain}}">

            <h5 id="heading" class="text-center small mb-3">Current stage: {{ current_stage }}</h5>

            <div class="d-flex">


                <img height="250" class="l-line" src="{% static 'img/line.png' %}">


                <br>

                <!-- <script>document.getElementById("{{stageName}}").selected = true;</script> -->
                <div class="form-actions col text-center form-group wufoo_update">
                    <p>
                        <a id="pipeline" href="#" target="_blank" class="disable-link">
                            <button class="btn btn-primary border-0 col-12 center-btn btn-disable" type="button">Pipeline
                            </button>
                        </a>
                    </p>
                    {% if current_stage != 'Appointment Set' %}
                        {% if MoreAppointments %}
                        <p>
                            <a id="Disposition" onclick="showLoaderOnClick('{% url 'appoinments' %}?context={{context_data}}&signature={{signature}}&opp_key={{opp_key}}')">
                                <button class="btn btn-primary border-0 col-11 center-btn" type="button">Appointments
                                    <span class="belly ms-1">
                                        <i class="iconify" data-icon="bi:bell-fill"></i>
                                        <b class="small">{{ appointments_count|length }}</b>
                                    </span>
                                    
                                </button>
                            </a>
                        </p>
                        {% else %}
                        <p>
                            <a id="Appointment_set" href="{{appt_set_url}}" target="_blank" class="{% if not appt_set_url %}disable-link{% endif %}">
                                <button class="btn btn-primary border-0 col-11 center-btn {% if not appt_set_url %}btn-disable{% endif %}" type="button">Appointment Set
                                </button>
                            </a>
                        </p>
                        {% endif %}
                    {% endif %}
                    {% if current_stage == 'Appointment Set' %}
                   
                    <p>
                        <a id="Disposition" href="{{appt_met_url}}" target="_blank" class="{% if not appt_met_url %}disable-link{% endif %}">
                            <button class="btn btn-primary border-0 col-10 center-btn {% if not appt_met_url %}btn-disable{% endif %}" type="button">Disposition Form  
                            </button>
                        </a>
                    </p>
                    {% endif %}  
                    <p>
                        <a  id="Agreement_signed" href="{{agreement_signed_url}}" target="_blank" class="{% if not agreement_signed_url %}disable-link{% endif %}">
                            <button  class="btn btn-primary border-0 col-9 center-btn {% if not agreement_signed_url %}btn-disable{% endif %}" type="button">Agreement Signed
                            </button>
                        </a>
                    </p> 
                    <p>
                        <a id="Pending" href="{{pending_url}}" target="_blank" class="{% if not pending_url %}disable-link{% endif %}">
                            <button  class="btn btn-primary border-0 col-8 center-btn {% if not pending_url %}btn-disable{% endif %}" type="button">Pending
                            </button>
                        </a>
                    </p> 
                    <p>
                        <a id="Closed" href="{{closed_url}}" target="_blank" class="{% if not closed_url %}disable-link{% endif %}">
                            <button class="btn btn-primary border-0 col-7 center-btn {% if not closed_url %}btn-disable{% endif %}" type="button">Closed
                            </button>
                        </a>
                    </p>
                   
                </div>
                <!-- Seprate screen for terminate button is no longer required -->
                <!-- <div class="form-actions col text-center form-group wufoo_terminate">
                    {% if current_stage != 'Appointment Set' %}
                    <p>
                        <a href="{{terminate_url}}" target="_blank" class="{% if not terminate_url %}disable-link{% endif %}">
                            <button class="btn btn-primary col-7 center-btn {% if not terminate_url %}btn-disable{% endif %}" type="button">Terminate
                            </button>
                        </a>
                    </p>
                    {% endif %}
                </div> -->
                

                <img height="250" class="r-line" src="{% static 'img/line.png' %}">

            </div>


        </form>

        <div class="d-flex flex-wrap w-100 mb-4 justify-content-end align-items-center">
           
            <span>
                {% if otc_property_id %}
                <a href="https://app.opentoclose.com/#projects/dashboard?type=properties" target="_blank">
                <img class="add-on bg-white p-1 mx-2 rounded border" height="30"
                    src="https://opentoclose.com/images/logo_purple.png">
                </a>
                {% endif %}
                {% if sisu_client_id %}
                <a href="https://my.sisu.co/transactions/edit/{{sisu_client_id}}" target="_blank">
                <img class="add-on rounded bg-white border" height="30"
                    src="{% static 'img/sisu.png' %}" alt="Sisu Transaction">
                </a>
                {% endif %}
            </span>
        </div>

        <hr class="hr col-12">
            <div class="mt-4 mb-4 d-flex flex-column justify-content-center align-items-center">
                <img src="https://datalabz.re/static/images/interface_logo.png" width="180">
                <a href="https://knowledge.interface.re/fub-embedded-app-documentation" target="_blank"
                    class="text-decoration-underline text-dark mt-2">Learn more about InterFace</a>
            </div>

    </div>



    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <!-- Iconify icons -->
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <script src="https://eia.followupboss.com/embeddedApps-v1.0.0.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="{% static 'js/conditionize.flexible.jquery.js' %}"></script>
    <script src="../../static/js/conditionize.flexible.jquery.js"></script>

    <!-- Became obsolete as Terminate button now directly opens terminate form -->
    <!-- <script>
        $('#terminate_toggle_btn').click(function(){
            if($(this).text() == "Terminate"){
                $(this).text("Cancel");
                $('#form_heading').text("Terminate Opportunity");
            }
            else{
                $(this).text("Terminate");
                $('#form_heading').text("Update Opportunity");
            }
            $('div.wufoo_update').toggle();
            $('div.wufoo_terminate').toggle();
        });  
    </script> -->
    <script>
        var heading = $('#heading').html()
        $(document).ready(function(){
            if(heading == "Current stage: Closed"){
                $('#Appointment_set, #Agreement_signed, #Pending, #Closed').css('pointer-events','none');
                $('.col-11, .col-9, .col-8, .col-7').addClass("btn-disable")
            }
        } 
        )
    </script>
    <script>

        function showLoader() {
            document.getElementById('demo').style.display = "none";
            document.getElementById('loader').style.display = "block";
        }
        var timeout;
    
        function sleep(delay, url) {
            if (timeout) {
                clearTimeout(timeout);
            }
            timeout = setTimeout(function () {
                window.location.href = url;
            }, delay);
        }
    
        function showLoaderOnClick(url) {
            showLoader();
            sleep(500, url);
        }
        
    </script>

</body>