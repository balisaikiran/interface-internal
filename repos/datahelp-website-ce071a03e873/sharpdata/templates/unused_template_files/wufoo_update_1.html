<!DOCTYPE html>
{% load static %}

<head>

    <!-- Fonts CDN -->
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />

    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">

    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css"
        integrity="sha512-63+XcK3ZAZFBhAVZ4irKWe9eorFG0qYsy2CaM5Z+F3kUn76ukznN0cp4SArgItSbDFD1RrrWgVMBY9C/2ZoURA=="
        rel="stylesheet" />
    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
        integrity="sha512-aEe/ZxePawj0+G2R+AaIxgrQuKT68I28qh+wgLrcAJOz3rxCP+TwrK5SPN+E5I+1IQjNtcfvb96HDagwrKRdBw=="
        rel="stylesheet" />
    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.css"
        integrity="sha512-2e0Kl/wKgOUm/I722SOPMtmphkIjECJFpJrTRRyL8gjJSJIP2VofmEbqyApMaMfFhU727K3voz0e5EgE3Zf2Dg=="
        rel="stylesheet" />
    <link crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.min.css"
        integrity="sha512-tjNtfoH+ezX5NhKsxuzHc01N4tSBoz15yiML61yoQN/kxWU0ChLIno79qIjqhiuTrQI0h+XPpylj0eZ9pKPQ9g=="
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


    <style>
        * {
            box-sizing: border-radius;
            font-family: "poppins" !important;
        }

        .l-line {
            margin-left: 20px;
            transform: rotate(-12deg);

        }

        .r-line {
            margin-right: 20px;
            transform: rotate(12deg);

        }
        .btn-disable{
            background: #9EBDD5 !important;
        }

        body {
            font-size: 13px;
            font-family: "poppins" !important;
            min-height: 400px;
             /* Added as bugfix */
            overflow-x: hidden;
	        overflow-y: visible;
        }

        .fs-small {
            font-size: 8px;
        }

        .add-on:hover {
            transform: scale(1.2);
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: ease-out 0.2s;
        }

        :root {
            --background-color: #eeeef5;
            --primary: #065697;
            --primary-hover: #065697;
        }

        .shadow-add {
            box-shadow: 0px 8px 8px rgba(0, 0, 0, 0.2);
        }

        .hrx {
            opacity: 0.1;
        }

        .card-chip:hover {
            box-shadow: 0 0.5rem 0.5rem rgba(0, 0, 0, .15) !important;
            transition: ease-out 0.1s;
        }

        .card-chip {
            cursor: pointer;
        }

        .bd {
            border: solid red 1px !important;
        }

        a {
            cursor: pointer;
        }

        a:hover {
            color: inherit;
        }

        .bg-color-1 {
            background: #F9F9F9;
        }

        .pointer {
            cursor: pointer;
        }

        img {
            object-fit: cover;
        }

        .text-justify {
            text-align: justify;
        }


        .btn-primary {
            background-color: var(--primary);
            font-size: 14px;
            border-color: var(--primary);
            color: #fff;
            outline: none !important;
        }

        .btn-primary:hover,
        .btn-primary:focus,
        .btn-primary:active {
            background-color: transparent;
            border-color: var(--primary-hover);
            color: #065697;
            outline: 0px !important;
        }

        .btn-primary-outline {
            background-color: transparent;
            border-color: var(--primary);
            color: var(--primary);
            outline: 0px !important;
        }

        .btn-primary-outline:hover,
        .btn-primary-outline:focus,
        .btn-primary-outline:active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: #ffffff;
            outline: 0px !important;
        }

        .text-primary {
            color: var(--primary) !important;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .input-bn {
            font-size: 14px;
            box-sizing: border-box;
            border-radius: 5px !important;
            border: 1.5px solid #8692A6 !important;
            height: 55px !important;
        }

        .input-bn:focus {
            border: 2px solid #065697 !important;
            box-shadow: none;
            background: #FFFFFF;
            box-sizing: border-box;
            border-radius: 6px;
        }

        textarea {
            font-size: 14px;
            box-sizing: border-box;
            border-radius: 5px !important;
            border: 1.5px solid #8692A6 !important;
            min-height: 150px !important;
        }

        textarea:focus {
            border: 2px solid #065697 !important;
            box-shadow: none !important;
            background: #FFFFFF;
            box-sizing: border-box;
            border-radius: 6px;
        }


        .form-floating>.form-control:focus~label,
        .form-floating>.form-control:not(:placeholder-shown)~label,
        .form-floating>.form-select~label {
            opacity: 1 !important;
            color: #808080;
            height: 15px !important;
            padding: 2px !important;
            background: white;
            transform: scale(1) translateY(-0.6rem) translateX(0.85rem) !important;
        }

        .form-floating>.form-control:focus,
        .form-floating>.form-control:not(:placeholder-shown) {
            padding-top: 0.925rem !important;
        }

        .form-floating>.form-select {
            padding-top: 0.925rem !important;
            padding-bottom: 0.625rem;
        }

        .testdiv1 {
            box-shadow: 4px 4px 10px #C4C4C4;
            width: 100%;
            background-color: #3240a8;
            display: flex;
            margin-top: 3%;
            color: white;
        }

        .Terminated_Stage {
            box-shadow: 4px 4px 10px #C4C4C4;
            width: 100%;
            background-color: #a84432;
            display: flex;
            margin-top: 3%;
            color: white;
        }

        .runnerIconImage {
            width: 38px;
            height: 38px;
        }

        .runnerBackground {
            margin: 15px;
            width: 35px;
            height: 35px;
            border-radius: 100px;
            padding: 20px;
            background-image: linear-gradient(45deg, #F5F7F9, #abd8ff);
        }

        .loading {
            position: fixed;
            z-index: 999;
            height: 2em;
            width: 2em;
            overflow: visible;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        /* Transparent Overlay */
        .loading:before {
            content: '';
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
        }

        /* :not(:required) hides these rules from IE9 and below */
        .loading:not(:required) {
            /* hide "loading..." text */
            font: 0/0 a;
            color: transparent;
            text-shadow: none;
            background-color: transparent;
            border: 0;
        }

        .loading:not(:required):after {
            content: '';
            display: block;
            font-size: 10px;
            width: 1em;
            height: 1em;
            margin-top: -0.5em;
            -webkit-animation: spinner 1500ms infinite linear;
            -moz-animation: spinner 1500ms infinite linear;
            -ms-animation: spinner 1500ms infinite linear;
            -o-animation: spinner 1500ms infinite linear;
            animation: spinner 1500ms infinite linear;
            border-radius: 0.5em;
            -webkit-box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.5) -1.5em 0 0 0, rgba(0, 0, 0, 0.5) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
            box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) -1.5em 0 0 0, rgba(0, 0, 0, 0.75) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
        }

        /* Animation */

        @-webkit-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-moz-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-o-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        .dhh1 {
            color: #3240a8;
            position: absolute;
            font-size: 2.5em;
            height: 1em;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2;
            margin: auto;
            text-align: center;
            opacity: 0;
            animation: appear 4s forwards;
            animation-iteration-count: infinite;
        }


        @keyframes appear {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }


        .boxcon {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: auto;
            height: 200px;
            width: 200px;
        }

        .box1 {
            position: absolute;
            height: 200px;
            width: 200px;
            border-radius: 50%;
            border: 2px solid rgb(0, 225, 255);
            animation-name: spinx;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            text-align: center;
        }

        .box2 {
            position: absolute;
            height: 200px;
            width: 200px;
            border-radius: 50%;
            border: 2px solid rgb(0, 255, 255);
            animation-name: spiny;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            text-align: center;
        }

        @keyframes spinx {
            0% {
                transform: rotateX(0deg);
            }

            100% {
                transform: rotateX(360deg);
            }
        }

        @keyframes spiny {
            0% {
                transform: rotateY(0deg);
            }

            100% {
                transform: rotateY(360deg);
            }
        }

        .error_message {
            color: red;
        }

        .reqField {
            font-size: 8px;
            color: red;
        }

        .missingField {
            color: red !important;
        }
        .wufoo_terminate {
            display: none;
        }
        
    </style>
</head>

<body class="bg-white">


    <div id="loader" style="display: none;">
        {% include "common_form/loader.html" %}    
    </div>
    <div id="demo" class="p-4">
        <div class=" d-flex justify-content-between align-items-center" id="back_button">
            <img src="https://fs.hubspotusercontent00.net/hub/21128156/hubfs/Interface-dark-logo.png?width=108&height=108"
                width="45">

            <b class="text-decoration-underline text-dark pointer"><i class="iconify"
                    data-icon="material-symbols:arrow-back-rounded"> </i> <a
                    onclick="showLoaderOnClick('{% url 'list_view' %}?context={{context_data}}&signature={{signature}}')"
                  > Go back </a></b>
        </div>

        <hr class="hr">

        <div class=" mb-4 d-flex justify-content-between align-items-center">
            <b class="fs-6" id="form_heading">Update Opportunity</b>

            {% if opp_stage != "Terminated" %}
            <a id="terminate_toggle_btn" type="submit" value="submit" title="Terminate Transaction"
                class="text-decoration-underline text-danger pointer">Terminate<i class="iconify" data-icon="ri:indeterminate-circle-line"></i></a>
            {% endif %}      
        </div>


        <form method="POST" class="mb-3 mt-4">
            {% csrf_token %}
            {% if deal_id %}
            <input hidden name="deal_id" value="{{deal_id}}">
            <input hidden name="appt_set_entry_id" value="{{appt_set_entry_id}}">
            <input hidden name="appt_set_lead_type" value="{{appt_set_lead_type}}">
            <input hidden name="appt_set_platform" value="{{appt_set_platform}}">
            {% endif %}
            <input hidden name="domain" value="{{domain}}">

            <h5 id="heading" class="text-center fs-6 mb-3">Current stage: {{ current_stage }}
            {% if MoreAppointments %}
                    <b id="view_appointments" class="btn btn-primary"><a
                        onclick="showLoaderOnClick('{% url 'appoinments' %}?context={{context_data}}&signature={{signature}}&opp_key={{opp_key}}')"
                    > View All Appointments </a></b>
            {% endif %}
            </h5>
            <div class="d-flex">


                <img height="250" class="l-line" src="{% static 'img/line.png' %}">


                <br>

                <!-- <script>document.getElementById("{{stageName}}").selected = true;</script> -->
                <div class="form-actions col text-center form-group wufoo_update">
                    <p>
                        <a id="pipeline">
                            <button class="btn btn-primary border-0 col-12 center-btn btn-disable" type="button">Pipeline
                            </button>
                        </a>
                    </p>
                    {% if current_stage != 'Appointment Set' %}
                    <p>
                        {% if appt_set_url %}
                            <a id="Appointment_set" href="{{appt_set_url}}" target="_blank">
                                <button class="btn btn-primary border-0 col-11 center-btn" type="button">Appointment Set
                                </button>
                            </a>
                        {% else %}
                            <a id="Appointment_set" target="_blank">
                                <button class="btn btn-primary border-0 col-11 center-btn btn-disable" type="button">Appointment Set
                                </button>
                            </a>
                        {% endif %}
                    </p>
                    {% endif %}
                    {% if current_stage == 'Appointment Set' %}
                    <p>
                        <a id="Disposition" href="{{appt_met_url}}" target="_blank">
                            <button class="btn btn-primary border-0 col-11 center-btn" type="button">Disposition Form
                            </button>
                        </a>
                    </p>
                    {% endif %}  
                    <p>
                        <a  id="Agreement_signed" href="{{agreement_signed_url}}" target="_blank">
                            <button  class="btn btn-primary border-0 col-10 center-btn" type="button">Agreement Signed
                            </button>
                        </a>
                    </p> 
                    <p>
                        <a id="Pending" href="{{pending_url}}" target="_blank">
                            <button  class="btn btn-primary border-0 col-9 center-btn" type="button">Pending
                            </button>
                        </a>
                    </p> 
                    <p>
                        <a id="Closed" href="{{closed_url}}" target="_blank">
                            <button class="btn btn-primary border-0 col-8 center-btn" type="button">Closed
                            </button>
                        </a>
                    </p>
                </div>

                <div class="form-actions col text-center form-group wufoo_terminate">
                    {% if current_stage != 'Appointment Set' %}
                    <p>
                        <a href="{{terminate_url}}" target="_blank">
                            <button class="btn btn-primary col-7 center-btn" type="button">Terminate
                            </button>
                        </a>
                    </p>
                    {% endif %}
                </div>

                <img height="250" class="r-line" src="{% static 'img/line.png' %}">

            </div>


        </form>
        <div class="d-flex flex-wrap w-100 mb-4 justify-content-end align-items-center">
           
            <span>
                {% if otc_property_id %}
                <a href="https://app.opentoclose.com/#projects/dashboard?type=properties" target="_blank">
                <img class="add-on bg-white p-1 mx-2 rounded border" height="30"
                    src="https://opentoclose.com/images/logo_purple.png">
                </a>
                {% endif %}
                {% if sisu_client_id %}
                <a href="https://my.sisu.co/transactions/edit/{{sisu_client_id}}" target="_blank">
                <img class="add-on rounded bg-white border" height="30"
                    src="{% static 'img/sisu.png' %}" alt="Sisu Transaction">
                </a>
                {% endif %}
            </span>
        </div>

        <!-- <hr class="hr"> -->
        <div class="mt-4 mb-4 d-flex flex-column justify-content-center align-items-center">
            <img src="https://datalabz.re/static/images/interface_logo.png" width="180">
            <a href="https://knowledge.interface.re/fub-embedded-app-documentation" target="_blank"
                class="text-decoration-underline text-dark mt-2">Learn more about InterFace</a>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <!-- Iconify icons -->
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <script src="https://eia.followupboss.com/embeddedApps-v1.0.0.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="{% static 'js/conditionize.flexible.jquery.js' %}"></script>
    <script src="../../static/js/conditionize.flexible.jquery.js"></script>

    <script>
        $('#terminate_toggle_btn').click(function(){
            if($(this).text() == "Terminate"){
                $(this).text("Cancel");
                $('#form_heading').text("Terminate Opportunity");
            }
            else{
                $(this).text("Terminate");
                $('#form_heading').text("Update Opportunity");
            }
            $('div.wufoo_update').toggle();
            $('div.wufoo_terminate').toggle();
        });  
    </script>
    <script>
        var heading = $('#heading').html()
        $(document).ready(function(){
            if(heading == "Current stage: Pipeline"){
                $('#pipeline').css('pointer-events','none');
                $('.col-12').addClass("btn-disable")
            }
            else if(heading == "Current stage: Appointment Set"){
                $('#pipeline, #Appointment_set').css('pointer-events','none');
                $('.col-12').addClass("btn-disable")
            }
            else if(heading == "Current stage: Appointment Met"){
                $('#pipeline, #Appointment_met').css('pointer-events','none');
                $('.col-12').addClass("btn-disable")
            }
            else if(heading == "Current stage: Agreement Signed"){
                $('#pipeline, #Appointment_met').css('pointer-events','none');
                $('.col-12').addClass("btn-disable")
            }
            else if(heading == "Current stage: Pending"){
                $('#pipeline, #Appointment_set, #Appointment_met, #Agreement_signed').css('pointer-events','none');
                $('.col-12, .col-11, .col-10').addClass("btn-disable")
            }
            else if(heading == "Current stage: Closed"){
                $('#pipeline, #Appointment_set, #Appointment_met, #Agreement_signed, #Pending, #Closed').css('pointer-events','none');
                $('.col-12, .col-11, .col-10, .col-9, .col-8').addClass("btn-disable")
            }
            else{
                console.log(heading)
            }
        } 
        )
    </script>
    <script>

        function showLoader() {
            document.getElementById('demo').style.display = "none";
            document.getElementById('loader').style.display = "block";
        }
        var timeout;
    
        function sleep(delay, url) {
            if (timeout) {
                clearTimeout(timeout);
            }
            timeout = setTimeout(function () {
                window.location.href = url;
            }, delay);
        }
    
        function showLoaderOnClick(url) {
            showLoader();
            sleep(500, url);
        }
        
    </script>
      
</body>