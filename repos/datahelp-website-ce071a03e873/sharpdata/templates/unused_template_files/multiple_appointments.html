<!DOCTYPE html>
{% load static %}

<head>
  <!-- Fonts CDN -->
  <link
    href="https://fonts.googleapis.com/css?family=Poppins"
    rel="stylesheet"
  />
  <!-- Bootstrap CDN -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
    crossorigin="anonymous"
  />

  <link
    href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    rel="stylesheet"
  />

  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css"
    integrity="sha512-63+XcK3ZAZFBhAVZ4irKWe9eorFG0qYsy2CaM5Z+F3kUn76ukznN0cp4SArgItSbDFD1RrrWgVMBY9C/2ZoURA=="
    rel="stylesheet"
  />
  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
    integrity="sha512-aEe/ZxePawj0+G2R+AaIxgrQuKT68I28qh+wgLrcAJOz3rxCP+TwrK5SPN+E5I+1IQjNtcfvb96HDagwrKRdBw=="
    rel="stylesheet"
  />
  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.css"
    integrity="sha512-2e0Kl/wKgOUm/I722SOPMtmphkIjECJFpJrTRRyL8gjJSJIP2VofmEbqyApMaMfFhU727K3voz0e5EgE3Zf2Dg=="
    rel="stylesheet"
  />
  <link
    crossorigin="anonymous"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.min.css"
    integrity="sha512-tjNtfoH+ezX5NhKsxuzHc01N4tSBoz15yiML61yoQN/kxWU0ChLIno79qIjqhiuTrQI0h+XPpylj0eZ9pKPQ9g=="
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    rel="stylesheet"
  />

  <style>
    * {
      box-sizing: border-radius;
      font-family: "poppins" !important;
    }

    .l-line {
      margin-left: 20px;
      transform: rotate(-12deg);
    }

    .r-line {
      margin-right: 20px;
      transform: rotate(12deg);
    }
    .btn-disable {
      background: #9ebdd5 !important;
    }

    body {
      font-size: 13px;
      font-family: "poppins" !important;
      min-height: 400px;
       /* Added as bugfix */
       overflow-x: hidden;
	    overflow-y: visible;
    }

    .fs-small {
      font-size: 8px;
    }

    .add-on:hover {
      transform: scale(1.2);
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: ease-out 0.2s;
    }

    :root {
      --background-color: #eeeef5;
      --primary: #065697;
      --primary-hover: #065697;
    }

    .shadow-add {
      box-shadow: 0px 8px 8px rgba(0, 0, 0, 0.2);
    }

    .hrx {
      opacity: 0.1;
    }

    .card-chip:hover {
      box-shadow: 0 0.5rem 0.5rem rgba(0, 0, 0, 0.15) !important;
      transition: ease-out 0.1s;
    }

    .card-chip {
      cursor: pointer;  
      border-width: 0.3px !important;
      border-left-width: 5px !important;
    }

    .bd {
      border: solid red 1px !important;
    }

    a {
      cursor: pointer;
    }

    a:hover {
      color: inherit;
    }

    .bg-color-1 {
      background: #f9f9f9;
    }

    .pointer {
      cursor: pointer;
    }

    img {
      object-fit: cover;
    }

    .text-justify {
      text-align: justify;
    }

    .btn-primary {
      background-color: var(--primary);
      font-size: 14px;
      border-color: var(--primary);
      color: #fff;
      outline: none !important;
    }

    .btn-primary:hover,
    .btn-primary:focus,
    .btn-primary:active {
      background-color: transparent;
      border-color: var(--primary-hover);
      color: #065697;
      outline: 0px !important;
    }

    .btn-primary-outline {
      background-color: transparent;
      border-color: var(--primary);
      color: var(--primary);
      outline: 0px !important;
    }

    .btn-primary-outline:hover,
    .btn-primary-outline:focus,
    .btn-primary-outline:active {
      background-color: var(--primary);
      border-color: var(--primary);
      color: #ffffff;
      outline: 0px !important;
    }

    .text-primary {
      color: var(--primary) !important;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .input-bn {
      font-size: 14px;
      box-sizing: border-box;
      border-radius: 5px !important;
      border: 1.5px solid #8692a6 !important;
      height: 55px !important;
    }

    .input-bn:focus {
      border: 2px solid #065697 !important;
      box-shadow: none;
      background: #ffffff;
      box-sizing: border-box;
      border-radius: 6px;
    }

    textarea {
      font-size: 14px;
      box-sizing: border-box;
      border-radius: 5px !important;
      border: 1.5px solid #8692a6 !important;
      min-height: 150px !important;
    }

    textarea:focus {
      border: 2px solid #065697 !important;
      box-shadow: none !important;
      background: #ffffff;
      box-sizing: border-box;
      border-radius: 6px;
    }

    .form-floating > .form-control:focus ~ label,
    .form-floating > .form-control:not(:placeholder-shown) ~ label,
    .form-floating > .form-select ~ label {
      opacity: 1 !important;
      color: #808080;
      height: 15px !important;
      padding: 2px !important;
      background: white;
      transform: scale(1) translateY(-0.6rem) translateX(0.85rem) !important;
    }

    .form-floating > .form-control:focus,
    .form-floating > .form-control:not(:placeholder-shown) {
      padding-top: 0.925rem !important;
    }

    .form-floating > .form-select {
      padding-top: 0.925rem !important;
      padding-bottom: 0.625rem;
    }

    .testdiv1 {
      box-shadow: 4px 4px 10px #c4c4c4;
      width: 100%;
      background-color: #3240a8;
      display: flex;
      margin-top: 3%;
      color: white;
    }

    .Terminated_Stage {
      box-shadow: 4px 4px 10px #c4c4c4;
      width: 100%;
      background-color: #a84432;
      display: flex;
      margin-top: 3%;
      color: white;
    }

    .error_message {
      color: red;
    }

    .reqField {
      font-size: 8px;
      color: red;
    }

    .missingField {
      color: red !important;
    }
    .wufoo_terminate {
      display: none;
    }

    .multiple_appointments {
      
    }

    .card-left-border {
      border-left-color: orange !important;
  }

  .met-card-left-border {
      border-left-color: green !important;
  }

  .custom-card-border{
    border:1px solid #dee2e6;

  }

  #heading {
    margin-right: 50px;
  }

  </style>
</head>

<body class="bg-white">
  <div id="loader" style="display: none">
    {% include "common_form/loader.html" %}
  </div>
  <div id="demo" class="p-4">
    <div
      class="d-flex justify-content-between align-items-center"
      id="back_button"
    >
      <img
        src="https://fs.hubspotusercontent00.net/hub/21128156/hubfs/Interface-dark-logo.png?width=108&height=108"
        width="45"
      />

      <b class="text-decoration-underline text-dark pointer"
        ><i class="iconify" data-icon="material-symbols:arrow-back-rounded">
        </i>
        <a
          onclick="showLoaderOnClick('{% url 'list_view' %}?context={{context_data}}&signature={{signature}}')"
        >
          Go back
        </a></b
      >
    </div>

    <hr class="hr" />

    <div class="mb-4 d-flex justify-content-between align-items-center">
      <b class="fs-6" id="form_heading">Update Opportunity</b>

      {# if opp_stage != "Terminated" #}
      <!-- <a
        id="terminate_toggle_btn"
        type="submit"
        value="submit"
        title="Terminate Transaction"
        class="text-decoration-underline text-danger pointer"
        >Terminate<i
          class="iconify"
          data-icon="ri:indeterminate-circle-line"
        ></i
      ></a> -->
      {# endif #}
    </div>

    <form method="POST" class="mb-3 mt-4">
      {% csrf_token %} {% if deal_id %}
      <input hidden name="deal_id" value="{{deal_id}}" />
      <input hidden name="appt_set_entry_id" value="{{appt_set_entry_id}}" />
      <input hidden name="appt_set_lead_type" value="{{appt_set_lead_type}}" />
      <input hidden name="appt_set_platform" value="{{appt_set_platform}}" />
      {% endif %}
      <input hidden name="domain" value="{{domain}}" />
      <div class="mb-5 d-flex justify-content-center align-items-center">
        <h5 id="heading" class="text-center fs-6">
          Current stage: {{ current_stage }}
        </h5>
        <a href="{{appt_set_url}}" target="_blank">
        <button id="view_appointments" class="btn btn-primary" type="button">
          Create New Appointment
        </button>
      </a>
      </div>
      <div class="d-flex">
        <div class="form-actions col text-center form-group wufoo_update">
          <div class="multiple_appointments">
            <section class="container p-0 pr-2 pe-2 col-lg-4 py-4 bg-white mx-auto my-auto" id="container">
              {% for op in appointments %}
              

              <div class="mb-4 card-chip custom-card-border {% if op.opp_stage == 'Appointment Met' %} met-card-left-border {% else %} card-left-border {% endif %} rounded rounded-3 w-100 bg-color-1">
                {% if op.opp_stage == "Appointment Met" %}
                    <a href="#" class="d-flex flex-column w-100 pb-0 px-3 justify-content-center">
                {% else %}
                    <a href="{{op.link}}" class="d-flex flex-column w-100 pb-0 px-3 justify-content-center" target="_blank">
                {% endif %}
                  <div
                      class="d-flex flex-wrap text-wrap w-100 pt-2 align-items-center justify-content-between">
                      {% if op.opp_stage %}
                          <b class="fs-6 m-0 fw-bold">{{op.opp_stage}}</b>
                      {% else %}
                          <b class="fs-6 m-0 fw-bold">Disposition Form </b>
                      {% endif %}

                      {% if op.opp_stage == "Appointment Met" %}
                            <p class="d-flex align-items-center m-0 p-0"><i class="iconify me-1"
                                      data-icon="fontisto:date"></i>
                                  {{op.opp_appt_met_date}}
                              </p>
                      {% else %}
                            <p class="d-flex align-items-center m-0 p-0"><i class="iconify me-1"
                                    data-icon="fontisto:date"></i>
                                {{op.appt_date}} {{op.appt_time}}
                            </p>
                      {% endif %}
                      
                      {% if op.opp_forecasted_close_date %}
                      <p class="d-flex align-items-center m-0 p-0"><i class="iconify me-1"
                              data-icon="fontisto:date"></i>
                          {{op.opp_forecasted_close_date}}
                      </p>
                      {% endif %}
                  </div>

                  <hr class="hrx w-100">

                  <div class="d-flex flex-column text-wrap w-100 justify-content-between">
                      <div class="d-flex mb-2 flex-wrap w-100">
                          <b class="fw-bold pe-2">{{op.opp_last_name}}{% if op.opp_address %}: </b><span class="">{{op.opp_address}}</span>{% else %}</b>{% endif %}
                      </div>

                      <div class="d-flex w-100 flex-wrap text-wrap justify-content-between">
                          <span class=""> {% if op.opp_stage == 'Appointment Set' or op.opp_stage == 'Pipeline' %}
                              {% if op.appt_set_lead_type %}
                              {{op.appt_set_lead_type}}
                              {% else %}
                              {{op.opp_type}}
                              {% endif %}
                              {% else %}
                              {{op.opp_type}}
                              {% endif %}
                          </span>
                          <!-- <p class="m-0 p-0"><span class="iconify" data-icon="ci:location-outline"></span>
                              <b>Location:</b> {% if op.location_name %} {{op.location_name}} {% else %} N/A {% endif %}
                          </p> -->
                      </div>
                  </div>
              </a>
              </div>
          {% endfor %}

            </section>

          </div>
        </div>
        <div class="form-actions col text-center form-group wufoo_terminate">
          {% if current_stage != 'Appointment Set' %}
          <p>
            <a href="{{terminate_url}}" target="_blank">
              <button class="btn btn-primary col-7 center-btn" type="button">
                Terminate
              </button>
            </a>
          </p>
          {% endif %}
        </div>
      </div>
    </form>
    <div
      class="d-flex flex-wrap w-100 mb-4 justify-content-end align-items-center"
    >
      <span>
        {% if otc_property_id %}
        <a
          href="https://app.opentoclose.com/#projects/dashboard?type=properties"
          target="_blank"
        >
          <img
            class="add-on bg-white p-1 mx-2 rounded border"
            height="30"
            src="https://opentoclose.com/images/logo_purple.png"
          />
        </a>
        {% endif %} {% if sisu_client_id %}
        <a
          href="https://my.sisu.co/transactions/edit/{{sisu_client_id}}"
          target="_blank"
        >
          <img
            class="add-on rounded bg-white border"
            height="30"
            src="{% static 'img/sisu.png' %}" alt="Sisu Transaction"
          />
        </a>
        {% endif %}
      </span>
    </div>

          <hr class="hr col-12">
            <div class="mt-4 mb-4 d-flex flex-column justify-content-center align-items-center">
                <img src="https://datalabz.re/static/images/interface_logo.png" width="180">
                <a href="https://knowledge.interface.re/fub-embedded-app-documentation" target="_blank"
                    class="text-decoration-underline text-dark mt-2">Learn more about InterFace</a>
            </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
  <!-- Iconify icons -->
  <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
  <!-- Bootstrap JS-->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://eia.followupboss.com/embeddedApps-v1.0.0.js"
    type="text/javascript"
  ></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{% static 'js/conditionize.flexible.jquery.js' %}"></script>
  <script src="../../static/js/conditionize.flexible.jquery.js"></script>

  <script>
    $("#terminate_toggle_btn").click(function () {
      // this function will change heading and toggle between two div
      if ($(this).text() == "Terminate") {
        $(this).text("Cancel");
        $("#form_heading").text("Terminate Opportunity");
      } else {
        $(this).text("Terminate");
        $("#form_heading").text("Update Opportunity");
      }
      $("div.wufoo_update").toggle();
      $("div.wufoo_terminate").toggle();
    });
  </script>
  <script>

    function showLoader() {
      document.getElementById("demo").style.display = "none";
      document.getElementById("loader").style.display = "block";
    }
    var timeout;

    function sleep(delay, url) {
      if (timeout) {
        clearTimeout(timeout);
      }
      timeout = setTimeout(function () {
        window.location.href = url;
      }, delay);
    }

    function showLoaderOnClick(url) {
      showLoader();
      sleep(500, url);
    }
  </script>
 
</body>
