<!DOCTYPE html>

{% load static %}

<head>
    <!-- jquery-ui -->
    <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
    <!-- Fonts CDN -->
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />

</head>

<body class="bg-white">
    <style>
        .tag{
            width:30px;
            position: absolute;
            margin-left: -15px;
        }
        * {
            box-sizing: border-radius;
            font-family: "poppins" !important;
        }
       
        /* ---------these are the card style--------- */
       

        /* ------------------------------------------- */


        body {
            font-size: 13px;
            font-family: "poppins" !important;
            min-height: 400px;
             /* Added as bugfix */
            overflow-x: hidden;
	        overflow-y: visible;
        }

        .add-on:hover {
            transform: scale(1.2);
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: ease-out 0.2s;
        }

        :root {
            --background-color: #eeeef5;
            --primary: #065697;
            --primary-hover: #065697;
        }

        .shadow-add {
            box-shadow: 0px 8px 8px rgba(0, 0, 0, 0.2);
        }

        .hrx {
            opacity: 0.1;
            margin-bottom: 9px;
            margin-top: 9px;
        }

        .card-chip:hover {
            box-shadow: 0 0.3rem 0.5rem rgba(0, 0, 0, .05) !important;
            transition: ease-out 0.1s;
        }

        .card-chip {
            cursor: pointer;
            border-width: 0.3px !important;
            border: 1px #E1DFDF solid !important;
            border-radius: 15px !important;
            /* overflow: hidden; */
        }
        .brdf{
            border-radius: 15px 15px 0px 0px;
        }

        .bd {
            border: solid red 1px !important;
        }

        a {
            cursor: pointer;
        }

        a:hover {
            color: inherit;
        }

        .bg-color-1 {
            background: #F5f5f5;
        }

        .pointer {
            cursor: pointer;
        }

        img {
            object-fit: cover;
        }

        .text-justify {
            text-align: justify;
        }


        .btn-primary {
            background-color: var(--primary);
            font-size: 14px;
            border-color: var(--primary);
            color: #fff;
            outline: none !important;
        }

        .btn-primary:hover,
        .btn-primary:focus,
        .btn-primary:active {
            background-color: transparent;
            border-color: var(--primary-hover);
            color: #065697;
            outline: 0px !important;
        }

        .btn-primary-outline {
            background-color: transparent;
            border-color: var(--primary);
            color: var(--primary);
            outline: 0px !important;
        }

        .btn-primary-outline:hover,
        .btn-primary-outline:focus,
        .btn-primary-outline:active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: #ffffff;
            outline: 0px !important;
        }

        .text-primary {
            color: var(--primary) !important;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .input-bn {
            font-size: 14px;
            box-sizing: border-box;
            border-radius: 5px !important;
            border: 1.5px solid #8692A6 !important;
            height: 55px !important;
        }

        .input-bn:focus {
            border: 2px solid #065697 !important;
            box-shadow: none;
            background: #FFFFFF;
            box-sizing: border-box;
            border-radius: 6px;
        }

        textarea {
            font-size: 14px;
            box-sizing: border-box;
            border-radius: 5px !important;
            border: 1.5px solid #8692A6 !important;
            min-height: 150px !important;
        }

        textarea:focus {
            border: 2px solid #065697 !important;
            box-shadow: none !important;
            background: #FFFFFF;
            box-sizing: border-box;
            border-radius: 6px;
        }


        .form-floating>.form-control:focus~label,
        .form-floating>.form-control:not(:placeholder-shown)~label,
        .form-floating>.form-select~label {
            opacity: 1 !important;
            color: #808080;
            height: 15px !important;
            padding: 2px !important;
            background: white;
            transform: scale(1) translateY(-0.6rem) translateX(0.85rem) !important;
        }

        .form-floating>.form-control:focus,
        .form-floating>.form-control:not(:placeholder-shown) {
            padding-top: 0.925rem !important;
        }

        .form-floating>.form-select {
            padding-top: 0.925rem !important;
            padding-bottom: 0.625rem;
        }

        .testdiv1 {
            box-shadow: 4px 4px 10px #C4C4C4;
            width: 100%;
            background-color: #F9F9F9;
            display: flex;
            margin-top: 3%;
            color: black;
        }

        .Terminated_Stage {
            box-shadow: 4px 4px 10px #C4C4C4;
            width: 100%;
            background-color: #a84432;
            display: flex;
            margin-top: 3%;
            color: white;
        }

        .runnerIconImage {
            width: 38px;
            height: 38px;
        }

        .runnerBackground {
            margin: 15px;
            width: 35px;
            height: 35px;
            border-radius: 100px;
            padding: 20px;
            background-image: linear-gradient(45deg, #F5F7F9, #abd8ff);
        }

        .loading {
            position: fixed;
            z-index: 999;
            height: 2em;
            width: 2em;
            overflow: visible;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        /* Transparent Overlay */
        .loading:before {
            content: '';
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
        }

        /* :not(:required) hides these rules from IE9 and below */
        .loading:not(:required) {
            /* hide "loading..." text */
            font: 0/0 a;
            color: transparent;
            text-shadow: none;
            background-color: transparent;
            border: 0;
        }

        .loading:not(:required):after {
            content: '';
            display: block;
            font-size: 10px;
            width: 1em;
            height: 1em;
            margin-top: -0.5em;
            -webkit-animation: spinner 1500ms infinite linear;
            -moz-animation: spinner 1500ms infinite linear;
            -ms-animation: spinner 1500ms infinite linear;
            -o-animation: spinner 1500ms infinite linear;
            animation: spinner 1500ms infinite linear;
            border-radius: 0.5em;
            -webkit-box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.5) -1.5em 0 0 0, rgba(0, 0, 0, 0.5) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
            box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) -1.5em 0 0 0, rgba(0, 0, 0, 0.75) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
        }

        /* Animation */

        @-webkit-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-moz-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-o-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @keyframes appear {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes spinx {
            0% {
                transform: rotateX(0deg);
            }

            100% {
                transform: rotateX(360deg);
            }
        }

        @keyframes spiny {
            0% {
                transform: rotateY(0deg);
            }

            100% {
                transform: rotateY(360deg);
            }
        }

        .iconify {
            width: 20px;
        }
    </style>

    <div id="loader" style="display: none;">
        {% include "common_form/loader.html" %}    
    </div>
    <section class="container p-0 pr-2 pe-2 py-4 bg-white mx-auto my-auto" id="container">
        <div class="w-100" id="workoutListMainDiv">

            <div class=" mb-4 d-flex justify-content-between align-items-center">
                <h5 style="font-size:1rem; font-weight: bold;" class="p-0 m-0 fw-bold">Opportunities
                    <b>({{oppurtunity_list|length}})</b></h5>
                <hr class="hr col">
                {% if form_type == 'wufoo_link' %}
                <a onclick="showLoaderOnClick('wufoo_form?context={{context_data}}&signature={{signature}}')"
                    class="btn btn-lg btn-primary d-flex align-items-center justify-content-center shadow-add p-0 rounded-circle shadow-lg"
                    style="width: 25px !important; height: 25px !important;">
                    <i class="fs-5 iconify" data-icon="mdi:plus"></i>
                </a>
                {% else %}
                <a onclick="showLoaderOnClick('form?context={{context_data}}&signature={{signature}}')"
                    class="btn btn-lg btn-primary d-flex align-items-center justify-content-center shadow-add p-0 rounded-circle shadow-lg"
                    style="width: 25px !important; height: 25px !important;">
                    <i class="fs-5 iconify" data-icon="mdi:plus"></i>
                </a>
                {% endif %}
            </div>

            <div class="d-flex mb-4 flex-column justify-content-center align-items-center">
                {% for op in oppurtunity_list %}
                {% if not op.notshow %}
                <div class="mb-4 card-chip custom-card-border
                    {% if op.opp_stage == 'Pipeline' %}{{op.opp_type}}-pipeline{% endif %}
                    {% if op.opp_stage == 'Appointment Set' %}{{op.opp_type}}-appointment-set{% endif %}
                    {% if op.opp_stage == 'Appointment Met' %}{{op.opp_type}}-appointment-met{% endif %}
                    {% if op.opp_stage == 'Appointment Missed' %}appointment-missed{% endif %}
                    {% if op.opp_stage == 'Agreement Signed' %}{{op.opp_type}}-agreement-signed{% endif %}
                    {% if op.opp_stage == 'Pending' %}{{op.opp_type}}-pending{% endif %}
                    {% if op.opp_stage == 'Closed' %}{{op.opp_type}}-closed{% endif %}
                    {% if op.opp_stage == 'Terminated' %}terminated{% endif %}
                     rounded rounded-3 w-100 bg-white">

                     <!-- tag icon iamge -------------- -->
                     <img src="tags.png" class="tag"> 
                      <!-- tag icon iamge -------------- -->

                    {% if form_type == 'wufoo_link' %}
                    {% if op.opp_stage == 'Terminated' %}
                    <a class="d-flex flex-column w-100 pb-0 px-03 justify-content-center">{% else %}
                        <a href="#" class="d-flex flex-column w-100 pb-0 px-3 justify-content-center"
                            onclick="showLoaderOnClick('/common_form/update_wufoo_form?stage={{op.opp_stage}}&opp_key={{op.teamFubDealId}}&deal_id={{op.fub_deal_id}}&team_id={{team_id}}&update_form=1&context={{context_data}}&signature={{signature}}')">
                            {% endif %}
                            {% else %}
                            {% if op.opp_stage == 'Terminated' %}
                            <a class="d-flex flex-column w-100 pb-0 px-03 justify-content-center">
                                {% else %}
                                <a href="#" class="d-flex flex-column w-100 pb-0 px-03 justify-content-center"
                                    onclick="showLoaderOnClick('/common_form/update_form?stage={{op.opp_stage}}&opp_key={{op.teamFubDealId}}&deal_id={{op.fub_deal_id}}&team_id={{team_id}}&update_form=1&context={{context_data}}&signature={{signature}}')">
                                    {% endif %}
                                    {% endif %}

                                    <div class="dropdown">
                                        <a class="fs-6 small m-0 fw-bold" href="#" role="button" data-bs-toggle="dropdown" >Opp_stage</a>
                                       
                                        <ul class="dropdown-menu shadow-lg p-3" style="min-width:250px;">
                                        </ul>
                                    </div>
                                    <div
                                        class="d-flex flex-wrap brdf bg-color-1 text-wrap w-100 px-3 py-3 border-bottom align-items-center justify-content-between">
                                        <b class="fs-6 m-0 fw-bold">{{op.opp_stage}}</b>
                                        {% if op.opp_forecasted_close_date %}
                                        <p class="d-flex align-items-center m-0 p-0"><i class="iconify me-1"
                                                data-icon="fontisto:date"></i>
                                            {{op.opp_forecasted_close_date}}
                                        </p>
                                        {% endif %}
                                    </div>

                               

                                    <div class="d-flex flex-column pt-3 pb-2 px-3 text-wrap w-100 justify-content-between">
                                        <div class="d-flex mb-3 flex-wrap w-100">
                                            <b class="fw-bold pe-2">{{op.opp_last_name}}{% if op.opp_address %}: </b><span class="">{{op.opp_address}}</span>{% else %}</b>{% endif %}
                                        </div>

                                        <div class="d-flex w-100 flex-wrap text-wrap justify-content-between">
                                            <span class=""> {% if op.opp_stage == 'Appointment Set' or op.opp_stage == 'Pipeline' %}
                                                {% if op.appt_set_lead_type %}
                                                {{op.appt_set_lead_type}}
                                                {% else %}
                                                {{op.opp_type}}
                                                {% endif %}
                                                {% else %}
                                                {{op.opp_type}}
                                                {% endif %}
                                            </span>
                                            <p class="m-0 p-0"><i class="iconify"
                                                    data-icon="material-symbols:real-estate-agent-outline"></i>
                                                <b>ISA:</b> {% if op.opp_isa %} {{op.opp_isa}} {% else %} N/A {% endif %}
                                            </p>
                                        </div>
                                    </div>

                                    <hr class="hrx w-100">

                                    <div class="d-flex pb-2 w-100 px-3 justify-content-between align-items-center">
                                        <h5 class="fw-bold fs-6 mb-2">$ {{op.opp_price}}</h5>
                                        <span>
                                            {% if op.otc_property_id and op.opp_stage != 'Terminated' %}
                                            <!-- <a href="https://app.opentoclose.com/#projects/dashboard?type=properties" target="_blank" -->
                                                <img onclick="window.open('https://app.opentoclose.com/#projects/dashboard?type=properties', '_blank')" class="add-on bg-white p-1 mx-2 rounded border mb-2" height="30"
                                                src="https://opentoclose.com/images/logo_purple.png">
                                                <!-- </a> -->
                                                {% endif %}
                                                {% if op.sisu_client_id and op.opp_stage != 'Terminated' %}
                                                <!--a href="https://my.sisu.co/transactions/edit/{{op.sisu_client_id}}" target="_blank"-->
                                                <img onclick="window.open('https://my.sisu.co/transactions/edit/{{op.sisu_client_id}}', '_blank')" class="add-on rounded bg-white border mb-2" height="30"
                                                src="{% static 'img/sisu.png' %}" alt="Sisu Transaction">
                                                <!-- </a> -->
                                                {% endif %}
                                            </span>
                                        </div>
                                </a>
                </div>
                {% endif %}
                {% empty %}
                <div class="d-flex mb-4 mt-4 flex-column justify-content-center align-items-center">
                    <img
                        src="{% static 'img/empty-state.png' %}">
                    <h5 class="fs-6 my-3 fw-bold">No Opportunities Found</h5>
                    <b class="pointer text-decoration-underline text-primary">
                        {% if form_type == 'wufoo_link' %}
                        <a onclick="showLoaderOnClick('wufoo_form?context={{context_data}}&signature={{signature}}')">Add
                            New+</b></a>
                    {% else %}
                    <a onclick="showLoaderOnClick('form?context={{context_data}}&signature={{signature}}')">Add
                        New+</b></a>
                    {% endif %}
                    <hr class="hr col-12">
                </div>

            </div>
            {% endfor %}


            <hr class="hr col-12">
            <div class="mt-4 mb-4 d-flex flex-column justify-content-center align-items-center">
                <img src="https://datalabz.re/static/images/interface_logo.png" width="180">
                <a href="https://knowledge.interface.re/fub-embedded-app-documentation" target="_blank"
                    class="text-decoration-underline text-dark mt-2">Learn more about InterFace</a>
            </div>
        </div>

    </section>

    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <!-- Iconify icons -->
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <!-- follow-up-boss -->
    <script src="https://eia.followupboss.com/embeddedApps-v1.0.0.js" type="text/javascript"></script>

    <script>

        function showLoader() {
            document.getElementById('container').style.display = "none";
            document.getElementById('loader').style.display = "block";

        }

        var timeout;

        function sleep(delay, url) {
            if (timeout) {
                clearTimeout(timeout);
            }
            timeout = setTimeout(function () {
                window.location.href = url;
            }, delay);
        }

        function myFunction() {
            console.log("slept for 1 second!");
        }

        function showLoaderOnClick(url) {
            showLoader();
            console.log("sleep for 0.5 second");
            sleep(500, url);
            console.log(url);

        }
    </script>
    <script>
        function htmlDecode(str) {
        const doc = new DOMParser().parseFromString(str, "text/html");
        return doc.documentElement.textContent;
        }
        //default stage colors as per sisu stages
        var default_stage_colors = {
            Pipeline: "#0098CE",
            AppointmentSet: "#00CEB1",
            AppointmentMet: "#005270",
            AgreementSigned: "#F9A21A",
            Pending: "#9D948A",
            Closed: "#FF5000"
        }
        //this function implements opp item border colors as per fub deal stages
        function initialize_border_col_classes(opp_type) {
            const data = document.getElementById(opp_type+"-data").textContent;
            console.log("DATA:", opp_type+"-data")
            const stage_colors =  JSON.parse(htmlDecode(data));
            var obj = {};
            if(stage_colors&&typeof stage_colors ==='string'){
            var objStr = stage_colors.match(/\{(.)+\}/g);
            eval("obj ="+objStr);
            console.log(opp_type+"_stage_colors", obj, typeof obj)
            }
            $('.'+opp_type+'-pipeline').css("border-left-color", default_stage_colors.Pipeline);
            $('.'+opp_type+'-appointment-set').css("border-left-color", default_stage_colors.AppointmentSet);
            $('.'+opp_type+'-appointment-met').css("border-left-color", default_stage_colors.AppointmentMet);
            $('.'+opp_type+'-agreement-signed').css("border-left-color", default_stage_colors.AgreementSigned);
            $('.'+opp_type+'-pending').css("border-left-color", default_stage_colors.Pending);
            $('.'+opp_type+'-closed').css("border-left-color", default_stage_colors.Closed)
            for (let [key, value] of Object.entries(obj)) {
                if(key.includes("Pipeline")){
                    $('.'+opp_type+'-pipeline').css("border-left-color", value != "" ? value : default_stage_colors.Pipeline)
                }
                if(key.includes("Appointment Set")){
                    $('.'+opp_type+'-appointment-set').css("border-left-color", value != "" ? value : default_stage_colors.AppointmentSet)
                }
                if(key.includes("Appointment Met")){
                    $('.'+opp_type+'-appointment-met').css("border-left-color", value != "" ? value : default_stage_colors.AppointmentMet)
                }
                if((key.includes("Pre Listing")) || (key.includes("Buyer Contract"))){
                    $('.'+opp_type+'-agreement-signed').css("border-left-color", value != "" ? value : default_stage_colors.AgreementSigned)
                }
                if(key.includes("Pending")){
                    $('.'+opp_type+'-pending').css("border-left-color", value != "" ? value : default_stage_colors.Pending)
                }
                if(key.includes("Closed")){
                    $('.'+opp_type+'-closed').css("border-left-color", value != "" ? value : default_stage_colors.Closed)
                }
            }
        }
        initialize_border_col_classes('Buyer')
        initialize_border_col_classes('Seller')  
    </script>

</body>